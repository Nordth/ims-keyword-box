var ImsKeywordBox=function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,o){return t&&i(e.prototype,t),o&&i(e,o),e}function n(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,i)}return o}function a(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,i=l(e);if(t){var s=l(this).constructor;o=Reflect.construct(i,arguments,s)}else o=i.apply(this,arguments);return c(this,o)}}function h(e){return function(e){if(Array.isArray(e))return y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||f(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){if(e){if("string"==typeof e)return y(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?y(e,t):void 0}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,i=new Array(t);o<t;o++)i[o]=e[o];return i}function p(e,t){var o;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(o=f(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var i=0,s=function(){};return{s:s,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,r=!0,a=!1;return{s:function(){o=e[Symbol.iterator]()},n:function(){var e=o.next();return r=e.done,e},e:function(e){a=!0,n=e},f:function(){try{r||null==o.return||o.return()}finally{if(a)throw n}}}}var w=function(){function e(t){o(this,e),this.selection={},this.count=0,this._lastActiveKeyword=null,this._lastActiveKeywordIndex=-1,this.value=[],this.setValue(t)}return s(e,[{key:"getIndexOfKeyword",value:function(e){return this.value.indexOf(e)}},{key:"getFirstSelectedIndex",value:function(){if(!this.value)return-1;for(var e=0;e<this.value.length;e++){var t=this.value[e];if(this.selection.hasOwnProperty(t)&&this.selection[t])return e}return-1}},{key:"getLastSelectedIndex",value:function(){if(!this.value)return-1;for(var e=this.value.length-1;e>=0;e--){var t=this.value[e];if(this.selection.hasOwnProperty(t)&&this.selection[t])return e}return-1}},{key:"setValue",value:function(e){var t=this;if(this.value=e||[],e){var o={},i=0;e.forEach((function(e,s){t.selection.hasOwnProperty(e)&&t.selection[e]&&(o[e]=!0,i++)})),this.selection=o,this.count=i}}},{key:"isSelected",value:function(e){return this.selection.hasOwnProperty(e)&&this.selection[e]}},{key:"isSelectedByIndex",value:function(e){return!(e>=this.value.length||e<0)&&this.isSelected(this.value[e])}},{key:"selectKeyword",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e){var o=t?a({},this.selection):{};o[e]=!0,this.selection=o,this.count=t?this.count+1:1}}},{key:"selectKeywordsArray",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(0!==e.length){var i=o?a({},this.selection):{};o||(this.count=0),e.forEach((function(e){i[e]||(i[e]=!0,t.count++)})),this.selection=i}}},{key:"clear",value:function(){0!==this.count&&(this.selection={},this.count=0)}},{key:"selectAll",value:function(){var e,t={},o=p(this.value);try{for(o.s();!(e=o.n()).done;){t[e.value]=!0}}catch(e){o.e(e)}finally{o.f()}this.selection=t,this.count=this.value.length}},{key:"deselectKeyword",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&(t?this.selection.hasOwnProperty(e)&&this.selection[e]&&(this.selection=a(a({},this.selection),{},n({},e,!1)),this.count--):(this.selection={},this.count=0))}},{key:"setSelectedState",value:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t?this.selectKeyword(e,o):this.deselectKeyword(e,o)}},{key:"setSelectedStateByIndex",value:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e>=this.value.length||e<0||(t?this.selectKeyword(this.value[e],o):this.deselectKeyword(this.value[e],o))}},{key:"selectRangeByIndexes",value:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e>t){var i=e;e=t,t=i}for(var s=o?a({},this.selection):{},n=o?this.count:0,r=Math.max(e,0);r<=Math.min(t,this.value.length-1);r++)s.hasOwnProperty(this.value[r])&&s[this.value[r]]||(s[this.value[r]]=!0,n++);this.selection=s,this.count=n}},{key:"getSiblingKeyword",value:function(e,t){return 0===t?e<this.value.length&&e>=0?this.value[e]:null:t>0?e<this.value.length-1?this.value[e+1]:null:e>0?this.value[e-1]:null}},{key:"getActiveSiblingKeyword",value:function(e){return this.getSiblingKeyword(this.lastActiveKeywordIndex,e)}},{key:"getSelectionAsArray",value:function(){var e=this;return 0===this.count?[]:this.value.filter((function(t){return e.selection.hasOwnProperty(t)&&e.selection[t]}))}},{key:"lastActiveKeyword",get:function(){return this._lastActiveKeyword},set:function(e){this._lastActiveKeyword=e,e?(this._lastActiveKeywordIndex=this.getIndexOfKeyword(e),this._lastActiveKeywordIndex<0&&(this._lastActiveKeyword=null)):this._lastActiveKeywordIndex=-1}},{key:"lastActiveKeywordIndex",get:function(){return this._lastActiveKeywordIndex},set:function(e){this.value.length>0?(e<0?e=0:e>this.value.length-1&&(e=this.value.length-1),this._lastActiveKeywordIndex=e,this._lastActiveKeyword=this.value[e]):(this._lastActiveKeywordIndex=-1,this._lastActiveKeyword=null)}}]),e}();function m(e,t){if(!e)return!1;if(void 0!==e.classList){if(e.classList.contains(t))return!0}else{if(void 0===e.className)return!1;if(e.className===t)return!0;if(e.className.split(/\s/).some((function(e){return e.trim()===t})))return!0}return!1}function v(e,t){if("undefined"==typeof window)return null;for(;e;){if(e===document)return null;if(m(e,t))return e;e=e.parentNode}return null}function g(e){e&&(void 0!==e.remove?e.remove():e.parentNode.removeChild(e))}var x=null;function K(e){if(!window||!window.navigator)return!1;if(!x){var t=window.navigator.userAgent,o=/Edge\/|Trident\/|MSIE /.test(t),i=!o&&/AppleWebKit/.test(t)&&/Mobile\/\w+/.test(t),s=i||/mac/i.test(window.navigator.platform),n=/apple/i.test(window.navigator.vendor),r=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(window.navigator.userAgent);x={ie:o,mac:s,safari:n,ios:i,mobile:r}}return x[e]}function b(e){return K("mac")?e.metaKey:e.ctrlKey}var k=function(){function e(t,i,s,n){if(o(this,e),!t.$el)throw new Error("ImsKeywordBox interaction context: Master component is not mounted");this.isDragging=n,this.component=t,this.startTime=Date.now(),this.startElement=i.target,this.destroyed=s,this.draggingMyKeywords=[],this.draggingCanvas=null,this.invalidateCache(),this.resetEventHandlers(this.isDragging,!1),this.startPoint=this.getMousePointInfo(i),this.curPoint=this.startPoint}return s(e,[{key:"invalidateCache",value:function(){this._cacheKeywordsElems=null,this._cacheKeywordsBounds={}}},{key:"onMouseEnd",value:function(e){this.component.isMobile&&e.preventDefault(),this.curPoint=this.getMousePointInfo(e),this.isDragging?"move"===e.dataTransfer.dropEffect&&this.deleteDraggingMyKeywords():this.startElement===e.target&&this.keywordClick(this.curPoint,e),this.destroy()}},{key:"onMouseUpdate",value:function(e){if(!this.component.isMobile){var t=b(e);if(this.curPoint=this.getMousePointInfo(e),this.isDragging){if(e.dataTransfer.types.includes("text/plain")&&e.preventDefault(),this.component.dragKeywordPosition=this.curPoint.kwdIndex,this.component.dragKeywordIsBegin=!1,this.curPoint.hoverKwdElement){var o=this._getKeywordBounds(this.curPoint.kwdIndex);o&&o.left+o.width/2>e.clientX&&(this.component.dragKeywordIsBegin=!0)}}else if(!this.startPoint.hoverKwdElement){var i=this.startPoint.kwdIndex+this.startPoint.offset;if(this.startPoint.kwdIndex===this.curPoint.kwdIndex)t||(this.component.selectedKeywords.count>0&&this.component.selectedKeywords.clear(),this.component.cursorPosition=i);else{this.component.cursorPosition=-1,i>this.curPoint.kwdIndex&&i--;var s=this.curPoint.kwdIndex;0!==this.curPoint.outside&&s++,this.component.selectedKeywords.lastActiveKeywordIndex=i,this.component.selectedKeywords.selectRangeByIndexes(i,s,t)}}}}},{key:"keywordClick",value:function(e,t){if(!e.delButton){var o=b(t),i=e.kwdIndex,s=-1,n=-1===this.component.cursorPosition?this.component.selectedKeywords.lastActiveKeywordIndex:this.component.cursorPosition;if(!e.hoverKwdElement){if(!t.shiftKey&&o)return;t.shiftKey?n>e.kwdIndex&&i++:(i=-1,s=e.kwdIndex+e.offset)}var r=0===t.button;if(2===t.button&&(r=this.component.selectedKeywords.count>0),i>=0&&r){if(t.shiftKey)-1!==this.component.cursorPosition&&(i<n&&n--,this.component.selectedKeywords.lastActiveKeywordIndex=n),this.component.selectedKeywords.selectRangeByIndexes(n,i,o);else{var a=this.component.selectedKeywords.isSelectedByIndex(i);if(o)this.component.selectedKeywords.setSelectedStateByIndex(i,!a,!0);else if(a){if(0===t.button){var l={x:t.clientX,y:t.clientY,kwdIndex:this.curPoint?this.curPoint.kwdIndex:null,kwdElement:null,kwdBounds:null};l.kwdIndex>=0&&(l.kwdElement=this._getHoverKwdElement(l.kwdIndex),l.kwdBounds=this._getKeywordBounds(l.kwdIndex)),this.component.openEditor({click:l})}}else this.component.selectedKeywords.setSelectedStateByIndex(i,!0);this.component.selectedKeywords.lastActiveKeywordIndex=i}this.component.cursorPosition=-1}else-1!==s&&(this.component.setCursorPosition(s,1===e.outside),this.component.selectedKeywords.clear())}}},{key:"getMousePointInfo",value:function(e){var t={kwdIndex:-1,offset:1,hoverKwdElement:null,outside:0,delButton:!1};if(!this.component.value||0===this.component.value.length)return t;var o=e.target;t.delButton=m(o,"ImsKeywordBox-keyword-delete"),(t.delButton||m(o,"ImsKeywordBox-separator-inside"))&&((o=v(o,"ImsKeywordBox-keyword"))||(o=e.target)),m(o,"ImsKeywordBox-keyword")&&((o=v(o,"ImsKeywordBox-keyword-wrapper"))||(o=e.target));var i=m(o,"ImsKeywordBox-keyword-wrapper"),s=m(o,"ImsKeywordBox-separator");return i||s?(t.kwdIndex=parseInt(o.dataset.kwdInd),i?(t.hoverKwdElement=i,t.offset=0):t.offset=1,t):this._findMousePointInfoByCoords(e.clientX,e.clientY)}},{key:"_findMousePointInfoByCoords",value:function(e,t){var o={kwdIndex:this.component.value?this.component.value.length-1:-1,offset:1,hoverKwdElement:null,outside:1},i=this._getLastKeywordBounds();if(!i)return o;if(t>i.bottom||t>i.top&&e>i.right)return o;var s=this._getFirstKeywordBounds();if(!s)return o;var n=e<i.left;if(t<s.bottom&&n)return o.kwdIndex=-1,o.offset=1,o.outside=-1,o;var r=t-s.top,a=Math.floor(r/s.height);return o.kwdIndex=this._findKeywordEdgeIndex(a,n?-1:1,s.top,s.height)+(n?-1:0),o.offset=1,o.outside=n?-1:1,o}},{key:"_findKeywordEdgeIndex",value:function(e,t,o,i){for(var s=0,n=this.component.value?this.component.value.length-1:-1;s<=n;){var r=Math.floor((n+s)/2),a=this._getKeywordBounds(r),l=a?Math.round((a.top-o)/i):0,d=this._getKeywordBounds(r+t),c=d?Math.round((d.top-o)/i):l+t;if(l===e&&c===e+t)return r;e<l||e===l&&-1===t?n=r-1:s=r+1}return s}},{key:"_getHoverKwdElement",value:function(e){if(!this._cacheKeywordsElems){if(!this.component.$refs.canvas)return null;this._cacheKeywordsElems=this.component.$refs.canvas.querySelectorAll(".ImsKeywordBox-keyword-wrapper")}return e<0||e>=this._cacheKeywordsElems.length?null:this._cacheKeywordsElems[e]}},{key:"_getKeywordBounds",value:function(e){if(!this._cacheKeywordsBounds.hasOwnProperty(e)){var t=this._getHoverKwdElement(e);if(!t)return null;this._cacheKeywordsBounds[e]=t.getBoundingClientRect()}return this._cacheKeywordsBounds[e]}},{key:"_getLastKeywordBounds",value:function(){return this._getKeywordBounds(this.component.value?this.component.value.length-1:-1)}},{key:"_getFirstKeywordBounds",value:function(){return this._getKeywordBounds(0)}},{key:"destroy",value:function(){this.component.dragKeywordPosition=null,this.component.dragKeywordIsBegin=!1,this.resetEventHandlers(this.isDragging,!0),g(this.draggingCanvas),this.destroyed&&this.destroyed()}},{key:"makeDragging",value:function(){this.isDragging||(this.isDragging=!0,this.resetEventHandlers(!1,!1))}},{key:"onDragLeave",value:function(){this.component.dragKeywordPosition=null,this.component.dragKeywordIsBegin=!1}},{key:"resetEventHandlers",value:function(e,t){var o=this;this._onMouseEndHandler&&(window.removeEventListener(e?"dragend":"mouseup",this._onMouseEndHandler),this._onMouseEndHandler=null),this._onMouseUpdateHandler&&(this.component.$el&&this.component.$el.removeEventListener(e?"dragover":"mousemove",this._onMouseUpdateHandler),this._onMouseUpdateHandler=null),this._invalidateCacheHandler&&(window.removeEventListener("resize",this._invalidateCacheHandler,{passive:!0}),window.removeEventListener("scroll",this._invalidateCacheHandler,{passive:!0}),this.component.$refs.scroller&&this.component.$refs.scroller.removeEventListener("scroll",this._invalidateCacheHandler),this._invalidateCacheHandler=null),e&&(this.component.$el.removeEventListener("dragleave",this._onDragLeaveHandler),this._onDragLeaveHandler=null),t||(this._onMouseEndHandler=function(e){return o.onMouseEnd(e)},this._onMouseUpdateHandler=function(e){return o.onMouseUpdate(e)},this._invalidateCacheHandler=function(e){return o.invalidateCache()},window.addEventListener(this.isDragging?"dragend":"mouseup",this._onMouseEndHandler),this.component.$el.addEventListener(this.isDragging?"dragover":"mousemove",this._onMouseUpdateHandler),window.addEventListener("resize",this._invalidateCacheHandler,{passive:!0}),window.addEventListener("scroll",this._invalidateCacheHandler,{passive:!0}),this.component.$refs.scroller.addEventListener("scroll",this._invalidateCacheHandler),this.isDragging&&(this._onDragLeaveHandler=function(e){return o.onDragLeave(e)},this.component.$el.addEventListener("dragleave",this._onDragLeaveHandler)))}},{key:"deleteDraggingMyKeywords",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;(t=void 0!==t?t:this.component.value)||(t=[]);var o=t;if(this.draggingMyKeywords.length>0){var i=-1;o=[];for(var s=0;s<t.length;s++){var n=t[s];this.draggingMyKeywords.indexOf(n)>=0?-1===i&&(i=s):o.push(n)}this.draggingMyKeywords=[],this.component.cursorPosition=i,e&&this.component.$emit("change",o)}return o}}]),e}(),C=function(){function e(t,i,s){o(this,e),this.component=t,this.destroyed=s,this._moveTextareaToCursor(i),this.selectAllDetectTimeout=null,this.selectAllTry=0,this._runHideTimeout()}return s(e,[{key:"_runHideTimeout",value:function(){var e=this;this._hideTimeout=setTimeout((function(){e._hideTimeout=null,e._hideTextarea()}),100)}},{key:"_moveTextareaToCursor",value:function(e){if(this.component.$refs.textArea){var t=this.component.$el.getBoundingClientRect();this.component.$refs.textArea.style.left=e.clientX-t.left-5+"px",this.component.$refs.textArea.style.top=e.clientY-t.top-5+"px",this.component.$refs.textArea.style.width="10px",this.component.$refs.textArea.style.height="10px",this.component.$refs.textArea.style.zIndex=1e4,this.component.$refs.textArea.focus(),this.component.$refs.textArea.value="";var o=this.component.getSelectionsAsJoinedString();this.component.$refs.textArea.value=o+" ",this.component.$refs.textArea.setSelectionRange(0,o.length),this.selectAllTry=0,this._detectSelectAll()}}},{key:"_detectSelectAll",value:function(){var e=this;this.selectAllTry>=10||(this.selectAllTry++,setTimeout((function(){e.component.$refs.textArea&&(e.component.$refs.textArea.selectionEnd===e.component.$refs.textArea.value.length?e.component.selectAll():e._detectSelectAll())}),500))}},{key:"_hideTextarea",value:function(){this.component.$refs.textArea&&(this.component.$refs.textArea.style.left=0,this.component.$refs.textArea.style.top=0,this.component.$refs.textArea.style.width=0,this.component.$refs.textArea.style.height=0,this.component.$refs.textArea.style.zIndex=-2)}},{key:"destroy",value:function(){this._hideTimeout&&clearTimeout(this._hideTimeout),this.selectAllDetectTimeout&&clearTimeout(this.selectAllDetectTimeout),this.destroyed&&this.destroyed(),this.component.$refs.textArea&&(this.component.$refs.textArea.value="")}}]),e}();function I(e,t,o,i,s,n,r,a,l,d){"boolean"!=typeof r&&(l=a,a=r,r=!1);const c="function"==typeof o?o.options:o;let u;if(e&&e.render&&(c.render=e.render,c.staticRenderFns=e.staticRenderFns,c._compiled=!0,s&&(c.functional=!0)),i&&(c._scopeId=i),n?(u=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,l(e)),e&&e._registeredComponents&&e._registeredComponents.add(n)},c._ssrRegister=u):t&&(u=r?function(e){t.call(this,d(e,this.$root.$options.shadowRoot))}:function(e){t.call(this,a(e))}),u)if(c.functional){const e=c.render;c.render=function(t,o){return u.call(o),e(t,o)}}else{const e=c.beforeCreate;c.beforeCreate=e?[].concat(e,u):[u]}return o}const _="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());function B(e){return(e,t)=>function(e,t){const o=_?t.media||"default":e,i=A[o]||(A[o]={ids:new Set,styles:[]});if(!i.ids.has(e)){i.ids.add(e);let o=t.source;if(t.map&&(o+="\n/*# sourceURL="+t.map.sources[0]+" */",o+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t.map))))+" */"),i.element||(i.element=document.createElement("style"),i.element.type="text/css",t.media&&i.element.setAttribute("media",t.media),void 0===P&&(P=document.head||document.getElementsByTagName("head")[0]),P.appendChild(i.element)),"styleSheet"in i.element)i.styles.push(o),i.element.styleSheet.cssText=i.styles.filter(Boolean).join("\n");else{const e=i.ids.size-1,t=document.createTextNode(o),s=i.element.childNodes;s[e]&&i.element.removeChild(s[e]),s.length?i.element.insertBefore(t,s[e]):i.element.appendChild(t)}}}(e,t)}let P;const A={};var S=I({render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("span",{staticClass:"ImsKeywordBoxEditor"},[o("input",{ref:"input",staticClass:"ImsKeywordBoxEditor-input",attrs:{type:"text"},domProps:{value:e.rawVal},on:{keydown:e._onKeyDown,blur:e._onBlur,input:function(t){return e._setValue(t.target.value)}}}),e._v(" "),o("span",{ref:"hidden",staticClass:"ImsKeywordBoxEditor-hidden"})])},staticRenderFns:[]},(function(e){e&&e("data-v-4eaaae34_0",{source:".ImsKeywordBoxEditor{position:relative;display:inline-block}.ImsKeywordBoxEditor-hidden,.ImsKeywordBoxEditor-input{outline:0;border:none;font-size:inherit;font-family:inherit;line-height:inherit;white-space:pre;display:block;padding:0;background:0 0;-webkit-text-size-adjust:none;text-size-adjust:none}.ImsKeywordBoxEditor-hidden{position:absolute;top:0;left:0;visibility:hidden;box-sizing:content-box;padding-right:5px}",map:void 0,media:void 0})}),{name:"ImsKeywordBoxEditor",props:{value:{}},data:function(){return{rawVal:this.value}},methods:{_updateSize:function(){if(this.$refs.hidden&&this.$refs.input){this.$refs.hidden.textContent=this.rawVal;var e=this.$refs.hidden.getBoundingClientRect();this.$refs.input.style.width=e.width+"px"}},_setValue:function(e){this.rawVal!==e&&(this.rawVal=e,this._updateSize(),this.$emit("input",e))},_onBlur:function(){this.$emit("blur")},setCursor:function(e){this.$refs.input&&this.$refs.input.setSelectionRange(e,e)},focus:function(){this.$refs.input&&this.$refs.input.focus()},blur:function(){this.$refs.blur&&this.$refs.blur.blur()},isSelectionAtFirst:function(){return this.$refs.input.selectionStart===this.$refs.input.selectionEnd&&0===this.$refs.input.selectionStart},isSelectionAtEnd:function(){return this.$refs.input.selectionStart===this.$refs.input.selectionEnd&&this.$refs.input.selectionStart===this.rawVal.length},_onKeyDown:function(e){if(this.$refs.input)switch(e.key){case"Enter":case"Escape":e.preventDefault(),this.$emit("command",{command:"commit"});break;case"Tab":e.preventDefault(),this.$emit("command",{command:"move",dir:e.shiftKey?-1:1,cursorAt:0});break;case"ArrowLeft":case"ArrowRight":var t="ArrowLeft"===e.key&&this.isSelectionAtFirst(),o="ArrowRight"===e.key&&this.isSelectionAtEnd();(t||o)&&(e.preventDefault(),this.$emit("command",{command:"move",dir:t?-1:1,cursorAt:o?0:null}));break;case"Backspace":case"Delete":var i="Backspace"===e.key&&this.isSelectionAtFirst(),s="Delete"===e.key&&this.isSelectionAtEnd();(i||s)&&(e.preventDefault(),this.$emit("command",{command:"delSep",dir:i?-1:1}))}}},mounted:function(){this._updateSize()},watch:{value:function(){this.rawVal!==this.value&&(this.rawVal=this.value,this._updateSize())}}},void 0,!1,void 0,!1,B,void 0,void 0),E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(i,e);var t=u(i);function i(){var e,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return o(this,i),(e=t.call(this)).size=s,e.history=[],e.pointer=0,e}return s(i,[{key:"init",value:function(e,t){this.component=e,this.history=[t]}},{key:"push",value:function(e){this.history=[e].concat(h(this.history.slice(this.pointer,this.pointer+this.size))),this.pointer=0}},{key:"undo",value:function(){this.pointer<this.history.length-1&&(this.pointer++,this.component.emitValue(this.history[this.pointer],!1))}},{key:"redo",value:function(){this.pointer>0&&(this.pointer--,this.component.emitValue(this.history[this.pointer],!1))}}]),i}(function(){function e(){o(this,e)}return s(e,[{key:"init",value:function(e,t){}},{key:"push",value:function(e){}},{key:"undo",value:function(){}},{key:"redo",value:function(){}}]),e}()),D=I({render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"ImsKeywordBox",class:{"state-focus":e.focused},on:{mousedown:e._onMouseDown,dragstart:e._onDragStart,dragenter:e._onDragEnter,drop:e._onDrop,contextmenu:e._onContextMenu}},[o("textarea",{ref:"textArea",staticClass:"ImsKeywordBox-textarea",attrs:{autocorrect:"off",autocapitalize:"off",spellcheck:"false"},on:{keydown:e._onTextareaKeyDown,blur:e._onTextareaBlur,focus:e._onTextareaFocus,paste:e._onTextareaPaste,copy:e._onTextareaCopy,cut:e._onTextareaCut,input:e._onTextareaInput}}),e._v(" "),o("div",{ref:"scroller",staticClass:"ImsKeywordBox-scroller",on:{"&scroll":function(t){return e.emitScroll(t)}}},[o("div",{ref:"canvas",staticClass:"ImsKeywordBox-canvas"},[e.value&&e.value.length>0?[o("span",{staticStyle:{"padding-right":"0.1px"}},[e._l(e.value,(function(t,i){return[o("span",{class:e.separatorComp.isNewLine?"ImsKeywordBox-line":"ImsKeywordBox-inline"},[e._showBetweenSeparatorBefore(i)?o("span",{staticClass:"ImsKeywordBox-separator",attrs:{"data-kwd-ind":i-1}},[e._v(e._s(0!==i||e.separatorComp.inside?e.separatorComp.between:e.separatorComp.first))]):e._e(),e.editorPosition===i?[o("ims-keyword-box-editor",{ref:"editor",refInFor:!0,staticClass:"ImsKeywordBox-editor",on:{blur:e._editorCommit,command:e._editorCommand},model:{value:e.editorValue,callback:function(t){e.editorValue=t},expression:"editorValue"}}),e.separatorComp.isNewLine||e.editorInstead?e._e():o("span",{staticClass:"ImsKeywordBox-separator",attrs:{"data-kwd-ind":i}},[e._v(e._s(0!==i||e.separatorComp.inside||e.separatorComp.before?e.separatorComp.between:e.separatorComp.first))])]:e._e(),e.editorPosition===i&&e.editorInstead?e._e():o("span",{staticClass:"ImsKeywordBox-keyword-wrapper",class:{"state-highlighted":e.selectedKeywords.isSelected(t)},attrs:{draggable:!e.isMobile,"data-kwd-ind":i}},[o("span",{staticClass:"ImsKeywordBox-keyword",class:e._getKeywordClasses(t,i)},[e._showInsideSeparatorBefore(i)?o("span",{staticClass:"ImsKeywordBox-separator-inside"},[e._v(e._s(0===i?e.separatorComp.first:e.separatorComp.text))]):e._e(),e._v(e._s(t)),e._showInsideSeparatorAfter(i)?o("span",{staticClass:"ImsKeywordBox-separator-inside"},[e._v(e._s(0===i?e.separatorComp.first:e.separatorComp.text))]):e._e(),e.showDeleteButton?o("span",{staticClass:"ImsKeywordBox-keyword-delete",on:{click:function(t){return e._onDeleteKeywordButtonClick(i)}}}):e._e()])]),e._showBetweenSeparatorAfter(i)?o("span",{staticClass:"ImsKeywordBox-separator",attrs:{"data-kwd-ind":i}},[e._v(e._s(0!==i||e.separatorComp.inside||e.editorPosition===i?e.separatorComp.between:e.separatorComp.first))]):e._e()],2)]}))],2)]:[o("div",{staticClass:"ImsKeywordBox-stub",class:{"state-cursor-after":0===e.cursorPosition&&e.focused||-1===e.dragKeywordPosition,"state-cursor-blink":0===e.cursorPosition&&e.focused&&null===e.dragKeywordPosition}})],e._v(" "),(!e.value||!e.value.length)&&0===e.editorPosition||e.value&&e.editorPosition===e.value.length?o("ims-keyword-box-editor",{ref:"editor",staticClass:"ImsKeywordBox-editor",on:{blur:e._editorCommit,command:e._editorCommand},model:{value:e.editorValue,callback:function(t){e.editorValue=t},expression:"editorValue"}}):e._e()],2)])])},staticRenderFns:[]},(function(e){e&&e("data-v-512d45a4_0",{source:".ImsKeywordBox{border:1px solid #ccc;border-radius:4px;position:relative;cursor:text}.ImsKeywordBox-scroller{padding:0 6px;height:100%;max-height:inherit;min-height:inherit;border-radius:inherit;overflow:auto;overflow-x:hidden;position:relative}.ImsKeywordBox-canvas{display:block;padding:4px 4px 4px 4px;line-height:2em;position:relative;user-select:none;outline:0;min-height:100%;box-sizing:border-box}.ImsKeywordBox-keyword-wrapper{white-space:nowrap;display:inline-block}.ImsKeywordBox-keyword-wrapper.state-highlighted{position:relative}.ImsKeywordBox-keyword-wrapper.state-highlighted>.ImsKeywordBox-keyword{cursor:text}.ImsKeywordBox-keyword-wrapper.state-highlighted:before{content:\"\";position:absolute;width:100%;height:2em;background:#e9e9e9;left:-4px;top:0;padding-left:4px;padding-right:5px}.ImsKeywordBox.state-focus .ImsKeywordBox-scroller>.ImsKeywordBox-canvas .ImsKeywordBox-keyword-wrapper.state-highlighted:before{background:#d7d4f0}.ImsKeywordBox-keyword-wrapper.state-highlighted{background:#faa}.ImsKeywordBox-textarea{width:0;height:0;overflow:hidden;padding:0;display:block;resize:none;position:absolute;background:0 0;border:none;top:0;left:0;color:transparent;outline:0;opacity:.01;-webkit-text-size-adjust:none;text-size-adjust:none;font-size:1px}.ImsKeywordBox-textarea::-moz-selection,.ImsKeywordBox-textarea::selection{color:transparent}.ImsKeywordBox-keyword{padding:2px 7px;border:1px solid #ccc;border-radius:4px;line-height:1.4em;display:inline-block;white-space:nowrap;cursor:default;background-color:rgba(250,250,250,.7);position:relative}.ImsKeywordBox-keyword.state-cursor-after:after,.ImsKeywordBox-keyword.state-cursor-before:after,.ImsKeywordBox-stub.state-cursor-after:after,.ImsKeywordBox-stub.state-cursor-before:after{content:\"\";display:block;width:1px;height:29px;background:#000;position:absolute;top:-2px;pointer-events:none}.ImsKeywordBox-keyword.state-cursor-after.state-cursor-blink:after,.ImsKeywordBox-keyword.state-cursor-before.state-cursor-blink:after,.ImsKeywordBox-stub.state-cursor-after.state-cursor-blink:after,.ImsKeywordBox-stub.state-cursor-before.state-cursor-blink:after{animation:ImsKeywordBox-cursor-blink .5s infinite alternate}.ImsKeywordBox-keyword.state-cursor-before:after,.ImsKeywordBox-stub.state-cursor-before:after{left:-5px}.ImsKeywordBox-keyword.state-cursor-after:after{right:-6px}.ImsKeywordBox-keyword.state-duplicate{background-color:#ff9c9c}.ImsKeywordBox-keyword.state-confirm-delete .ImsKeywordBox-keyword-delete{animation:ImsKeywordBox-confirm-delete-blink .5s 2}.ImsKeywordBox-stub{display:inline-block;width:1px;height:1.4em;position:relative}.ImsKeywordBox-stub.state-cursor-after:after{right:0}.ImsKeywordBox-separator{position:relative;display:inline-block;white-space:pre}.ImsKeywordBox-separator:first-child,.ImsKeywordBox-separator:last-child{color:#aaa}.ImsKeywordBox-line{display:block}.ImsKeywordBox-keyword-delete{background:url(\"data:image/svg+xml,%3Csvg viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='m18.011 3.8674-6.0106 6.0106-6.0106-6.0106-2.1212 2.1212 6.0106 6.0106-6.0106 6.0106 2.1212 2.1212 6.0106-6.0106 6.0106 6.0106 2.1212-2.1212-6.0106-6.0106 6.0106-6.0106z'/%3E%3C/svg%3E%0A\") no-repeat right center;display:inline-block;width:12px;height:12px;cursor:pointer;background-size:contain;opacity:.5;position:relative;top:1px;margin-left:4px}.ImsKeywordBox-keyword-delete:hover{opacity:1}@keyframes ImsKeywordBox-cursor-blink{0%{opacity:1}49.9%{opacity:1}50%{opacity:0}100%{opacity:0}}@keyframes ImsKeywordBox-confirm-delete-blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}",map:void 0,media:void 0})}),{name:"ImsKeywordBox",components:{ImsKeywordBoxEditor:S},props:{value:{},showDeleteButton:{type:Boolean,default:!0},separator:{type:[String,Object],default:", "},splittingRegexp:{type:RegExp,default:function(){return/[;,\r\n#]/}},preprocessKeyword:{type:Function,default:null},getKeywordClasses:{type:Function,default:null},scrollY:{type:Number,default:0},handleExceptions:{type:Function,default:null},emitValueEvent:{type:String,default:"input"},customizeMultiKeywordDraggingCanvas:{type:Function,default:null},historyController:{type:Object,default:function(){return new E}}},data:function(){return{selectedKeywords:new w(this.value),cursorPositionRaw:-1,cursorPositionAfter:!1,interactionContext:null,contextMenuContext:null,highlightDuplicated:null,dragKeywordPosition:null,dragKeywordIsBegin:!1,muteNativeClipboardEventsTime:Date.now()-100,focused:!1,editorPosition:-1,editorInstead:!1,editorValue:null,isMobile:!1,confirmDeleteIndex:null}},computed:{cursorPosition:{get:function(){return this.cursorPositionRaw},set:function(e){this.cursorPositionRaw=e,this.cursorPositionAfter=!1}},separatorComp:function(){var e={isNewLine:!1,text:this.separator,inside:!1,before:!1,first:null,between:null};return this.separator&&"object"===t(this.separator)&&Object.assign(e,this.separator),null!==e.between&&e.inside||(e.between=e.inside?" ":e.text),e.isNewLine="\r\n"===e.text,null===e.first&&(e.first=e.text,e.isNewLine?e.first="":e.before&&(e.first=e.first.replace(/^\s+/,""))),e}},methods:{setCursorPosition:function(e,t){this.cursorPositionRaw=e,this.cursorPositionAfter=t},deleteSelectedKeywords:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;(t=void 0!==t?t:this.value)||(t=[]);var o=t;if(this.selectedKeywords.count>0){var i=-1;o=[];for(var s=0;s<t.length;s++){var n=t[s];this.selectedKeywords.isSelected(n)?-1===i&&(i=s):o.push(n)}this.selectedKeywords.clear(),this.cursorPosition=i,e&&this.emitValue(o)}return o},eraseEofCommand:function(){var e=this.selectedKeywords.count>0?this.selectedKeywords.getFirstSelectedIndex():this.cursorPosition;e<0&&(e=0);var t=this.value?this.value.slice(0,e):[];this.cursorPosition=t.length,this.selectedKeywords.clear(),this.emitValue(t)},clearCommand:function(){this.selectedKeywords.clear(),this.cursorPosition=-1,this.emitValue([])},deleteWordFromCursor:function(e){if(this.cursorPosition>=0){var t=this.value?h(this.value):[];t.splice(this.cursorPosition+e,1),this.cursorPosition=Math.max(this.cursorPosition+e,0),this.selectedKeywords.clear(),this.emitValue(t)}},getSelectionsAsJoinedString:function(){var e=this.selectedKeywords.getSelectionAsArray(),t=this.separatorComp.text;this.separatorComp.inside&&(this.separatorComp.before?t=this.separatorComp.between+t:t+=this.separatorComp.between);var o=e.join(t);return this.separatorComp.before&&(o=this.separatorComp.first+o),o},copyCommand:function(){var e,t=this;return this.selectedKeywords.count>0?(e=this.getSelectionsAsJoinedString(),navigator.clipboard.writeText(e).then(null,(function(t){var o=document.createElement("textarea");o.style.position="fixed",o.style.top="0",o.style.left="0",o.style.width="10px",o.style.height="10px",document.body.appendChild(o),o.value=e,o.focus(),o.setSelectionRange(0,o.value.length),document.execCommand("copy"),document.body.removeChild(o)}))).then(null,(function(e){if(!t.handleExceptions||!t.handleExceptions(e))throw e})):Promise.resolve()},cutCommand:function(){var e=this;return this.selectedKeywords.count>0?this.copyCommand().then((function(){e.deleteSelectedKeywords()})):Promise.resolve()},pasteCommand:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t=void 0!==t?t:this.value,this.selectedKeywords.count>0&&(t=this.deleteSelectedKeywords(!1)),e?this._pasteCommandImpl(this.cursorPosition,t,e,o):o?o(t):this.emitValue(t)},selectAll:function(){this.cursorPosition=-1,this.selectedKeywords.selectAll()},focus:function(){this.$refs.textArea&&this.$refs.textArea.focus()},emitScroll:function(){this.$refs.scroller&&this.$emit("update:scrollY",this.$refs.scroller.scrollTop)},_pasteCommandImpl:function(e,t,o){var i=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(o){e<0&&(e=0),t||(t=[]);var n=t,r=this.splittingRegexp?o.split(this.splittingRegexp):[o],l=r;if(this.preprocessKeyword){l=[];for(var d=0;d<r.length;d++){var c=this.preprocessKeyword(r[d]);c&&(Array.isArray(c)?l=l.concat(c):l.push(c))}}for(var u=new Set(n),f=new Set,y=[],p=null,w=0;w<l.length;w++){var m=this.preprocessKeyword?l[w]:l[w].trim();if(m&&!f.has(m)){if(f.add(m),u.has(m)){p||(p={}),p[m]=Date.now();var v=t.indexOf(m);if(v<e)continue;(t=t!==n?t:h(t)).splice(v,1)}y.push(m)}}if(this.selectedKeywords.clear(),this.cursorPosition=e+y.length,this.selectedKeywords.lastActiveKeywordIndex=this.cursorPosition,0!==y.length||t!==n){var g=h(t);g.splice.apply(g,[e,0].concat(y)),s?s(g):this.emitValue(g)}if(p)if(this.highlightDuplicated)this.highlightDuplicated=a(a({},this.highlightDuplicated),p);else{this.highlightDuplicated=p;var x=function e(){if(i.highlightDuplicated){var t=null,o=Date.now()-600;for(var s in i.highlightDuplicated)i.highlightDuplicated.hasOwnProperty(s)&&i.highlightDuplicated[s]>o&&(t||(t={}),t[s]=i.highlightDuplicated[s]);i.highlightDuplicated=t,i.highlightDuplicated&&setTimeout(e,200)}};setTimeout(x,200)}return y}},_onMouseDown:function(e){var t=this;v(e.target,"ImsKeywordBox-editor")||(this.$refs.textArea&&(this.isMobile?(this.$refs.textArea.focus(),e.preventDefault()):setTimeout((function(){t.$refs.textArea&&t.$refs.textArea.focus()}),10)),this.interactionContext||(this.interactionContext=new k(this,e,(function(){return t.interactionContext=null}),!1)))},_onTextareaFocus:function(){var e=this;this.focused=!0,setTimeout((function(){document.activeElement===e.$refs.textArea&&(e.focused||e.$emit("focus"))}),100)},_onTextareaBlur:function(){var e=this;this.isMobile&&this.interactionContext?this.$refs.textArea.focus():(this.focused=!1,setTimeout((function(){document.activeElement!==e.$refs.textArea&&e.focused&&e.$emit("blur")}),100))},_onDragStart:function(e){var t=this,o=e.target.dataset.kwdInd;if(void 0!==o&&(this.selectedKeywords.isSelectedByIndex(o)||(this.cursorPosition=-1,this.selectedKeywords.setSelectedStateByIndex(o,!0,!1)),e.dataTransfer.setData("text/plain",this.getSelectionsAsJoinedString()),this.interactionContext?this.interactionContext.isDragging||this.interactionContext.makeDragging():this.interactionContext=new k(this,e,(function(){return t.interactionContext=null}),!0),this.interactionContext.draggingMyKeywords=this.selectedKeywords.getSelectionAsArray(),this.selectedKeywords.count>1)){var i=document.createElement("canvas");if(i.style.position="absolute",i.style.left="-100%",document.body.append(i),this.customizeMultiKeywordDraggingCanvas)this.customizeMultiKeywordDraggingCanvas(i,this.selectedKeywords);else{var s=i.getContext("2d");i.width=24,i.height=15,s.fillStyle="#d7d4f0",s.fillRect(0,0,i.width,i.height),s.fillStyle="#000",s.font="12px "+getComputedStyle(this.$el).fontFamily,s.textBaseline="top",s.textAlign="center",s.fillText(this.selectedKeywords.count,12,3)}e.dataTransfer.setDragImage(i,-20,-10),this.interactionContext.draggingCanvas=i}},_onDragEnter:function(e){var t=this;v(e.target,"ImsKeywordBox-editor")||(e.dataTransfer.types.includes("text/plain")&&e.preventDefault(),this.interactionContext?this.interactionContext.isDragging||this.interactionContext.makeDragging():this.interactionContext=new k(this,e,(function(){return t.interactionContext=null}),!0))},_onDrop:function(e){if(!v(e.target,"ImsKeywordBox-editor")){var t=e.dataTransfer.getData("text/plain");e.preventDefault();var o=this.value?this.value:[],i=o[this.dragKeywordPosition];if(this.editorPosition>=0&&(this.editorInstead&&(o=h(o)).splice(this.editorPosition,1),this.editorPosition=-1),this.interactionContext){if(this.interactionContext.draggingMyKeywords.indexOf(i)>=0){var s=new Set;this.interactionContext.draggingMyKeywords.forEach((function(e,t){s.add(e)}));for(var n=null,r=0,a=!1,l=0;l<o.length;l++)s.has(o[l])?(null===n&&(n=l,r++),a||o[l]!==i||(this.dragKeywordPosition=n-1,this.dragKeywordIsBegin=!1,i=this.dragKeywordPosition>=0?this.value[this.dragKeywordPosition]:null,a=!0)):n=null;if(1===r)return void this.interactionContext.destroy()}o=this.interactionContext.deleteDraggingMyKeywords(!1,o)}var d=i?o.indexOf(i):this.dragKeywordPosition;d<0&&(d=this.dragKeywordPosition);var c=this._pasteCommandImpl(d+(this.dragKeywordIsBegin?0:1),o,t);this.cursorPosition=-1,this.selectedKeywords.selectKeywordsArray(c),this.interactionContext&&this.interactionContext.destroy()}},_onTextareaKeyDown:function(e){var t,o=this,i=!1,s=!(t=e).key||t.altKey||t.ctrlKey||t.metaKey?null:"Spacebar"===t.key?" ":1===t.key.length||t.key.length>1&&/[^a-zA-Z0-9]/.test(t.key)?t.key:null,n=!!s,r=b(e),a=this.value?this.value:[];switch(e.key){case"Shift":case"Alt":case"AltGraph":case"Control":case"Tab":case"CapsLock":case"Fn":case"FnLock":case"Hyper":case"Meta":case"OS":case"NumLock":case"ScrollLock":case"Scroll":case"Super":case"Symbol":case"SymbolLock":return;case"PageUp":case"PageDown":case"Insert":n=!0;break;case"ArrowUp":case"ArrowDown":if(this.selectedKeywords.count>0&&!e.shiftKey){var l="ArrowDown"===e.key?1:-1;this.cursorPosition=l>0?this.selectedKeywords.getLastSelectedIndex()+1:this.selectedKeywords.getFirstSelectedIndex(),this.selectedKeywords.clear(),i=!0}break;case"ArrowLeft":case"ArrowRight":n=!0;var d="ArrowRight"===e.key?1:-1;if(this.selectedKeywords.count>0){if(r||e.shiftKey){var c=e.shiftKey,u=this.selectedKeywords.getActiveSiblingKeyword(d);u&&(c&&this.selectedKeywords.isSelected(u)?this.selectedKeywords.deselectKeyword(this.selectedKeywords.lastActiveKeyword,!0):this.selectedKeywords.selectKeyword(u,c),this.selectedKeywords.lastActiveKeywordIndex+=d)}else this.cursorPosition=d>0?this.selectedKeywords.getLastSelectedIndex()+1:this.selectedKeywords.getFirstSelectedIndex(),this.selectedKeywords.clear();i=!0}else if(r){if(e.shiftKey){var h=this.selectedKeywords.getSiblingKeyword(this.cursorPosition,d<0?-1:0);h&&(this.selectedKeywords.selectKeyword(h),this.selectedKeywords.lastActiveKeywordIndex=this.cursorPosition+(d<0?-1:0),this.cursorPosition=-1)}else this.cursorPosition=Math.min(Math.max(this.cursorPosition+d,0),a.length);i=!0}else(d<0&&0===this.cursorPosition||d>0&&this.cursorPosition===a.length)&&(i=!0);break;case"Clear":this.clearCommand(),i=!0;break;case"eraseEofCommand":this.eraseEofCommand(),i=!0;break;case"End":case"Home":var f="Home"===e.key?0:a.length;if(e.shiftKey){var y=this.selectedKeywords.count>0?this.selectedKeywords.lastActiveKeywordIndex:this.cursorPosition;y>f&&0===f&&0===this.selectedKeywords.count&&y--,this.selectedKeywords.selectRangeByIndexes(y,f,!0),this.selectedKeywords.lastActiveKeywordIndex=f,this.cursorPosition=-1}else this.selectedKeywords.clear(),this.cursorPosition=f;i=!0;break;case"Delete":case"Backspace":n=!0,this.selectedKeywords.count>0&&-1===this.cursorPosition?(this.deleteSelectedKeywords(),i=!0):r&&(this.deleteWordFromCursor("Delete"===e.key?0:-1),i=!0);break;default:var p=function(e){if(void 0!==e.code)return e.code;var t={65:"KeyA",67:"KeyC",86:"KeyV",88:"KeyX",89:"KeyY",90:"KeyZ"};return t.hasOwnProperty(e.which)?t[e.which]:null}(e);if("Copy"===e.key||"KeyC"===p&&r)this.muteNativeClipboardEventsTime=Date.now(),this.copyCommand(),i=!0;else if("Cut"===e.key||"KeyX"===p&&r)this.muteNativeClipboardEventsTime=Date.now(),this.cutCommand(),i=!0;else{if("Paste"===e.key||"KeyV"===p&&r)return void(this.$refs.textArea&&(this.$refs.textArea.value=""));"Redo"===e.key||"KeyY"===p&&r||"KeyZ"===p&&r&&e.shiftKey?(this.historyController&&this.historyController.redo(),i=!0):"Undo"===e.key||"KeyZ"===p&&r?(this.historyController&&this.historyController.undo(),i=!0):"KeyA"===p&&r&&(this.selectAll(),i=!0)}}if(i)e.preventDefault(),this.$nextTick((function(){var e=o.selectedKeywords.count>0?o.selectedKeywords.lastActiveKeywordIndex:o.cursorPosition;if(!(e<0)&&o.$el){var t=o.$el.querySelector('.ImsKeywordBox-keyword-wrapper[data-kwd-ind="'+e+'"]');if(t)if(K("ie")||K("safari")||K("ios")){if(!o.$refs.scroller)return;var i=o.$refs.scroller.getBoundingClientRect(),s=t.getBoundingClientRect();s.bottom<i.top+10?(o.$refs.scroller.scrollTop-=i.top-s.bottom+s.height,o.emitScroll()):s.top>i.bottom-10&&(o.$refs.scroller.scrollTop+=s.top-i.bottom+s.height,o.emitScroll())}else t.scrollIntoView({block:"nearest"})}}));else if(n){var w=this.value?this.value:[];s&&this.selectedKeywords.count>0&&(w=this.deleteSelectedKeywords());var m={keyDownEvent:e};s&&this.cursorPosition===w.length&&w.length>0&&(this.splittingRegexp&&this.splittingRegexp.test(s)||(m.appendSeparator=this.separatorComp.text)),this.openEditor(m)}},_onTextareaPaste:function(e){if(e.preventDefault(),!(this.muteNativeClipboardEventsTime+100>Date.now())){this.muteNativeClipboardEventsTime=Date.now();var t=(e.originalEvent||e).clipboardData.getData("text/plain");this.pasteCommand(t)}},_onTextareaCopy:function(e){e.preventDefault(),this.muteNativeClipboardEventsTime+100>Date.now()||(this.muteNativeClipboardEventsTime=Date.now(),this.copyCommand())},_onTextareaCut:function(e){e.preventDefault(),this.muteNativeClipboardEventsTime+100>Date.now()||(this.muteNativeClipboardEventsTime=Date.now(),this.cutCommand())},_onTextareaInput:function(e){e.preventDefault(),this.selectedKeywords.count>0&&this.deleteSelectedKeywords(),this.openEditor({put:e.data})},deleteKeywordByIndex:function(e){if(this.value&&!(this.value.length<=e)){var t=h(this.value);t.splice(e,1),this.emitValue(t)}},openEditor:function(e){var t=this;this.editorPosition=this.cursorPosition,this.editorValue=null,this.editorInstead=!!e.instead;var o=null!==e.cursorAt&&void 0!==e.cursorAt?e.cursorAt:null;if(e.put&&(this.editorValue=e.put),e.keyDownEvent)switch(e.keyDownEvent.key){case"ArrowLeft":this.editorInstead=!0,this.editorPosition--,e.keyDownEvent.preventDefault();break;case"ArrowRight":this.editorInstead=!0,e.keyDownEvent.preventDefault(),o=0;break;case"Delete":this.editorInstead=!0,o=0;break;case"Backspace":this.editorInstead=!0,this.editorPosition--}e.click&&e.click.kwdIndex>=0&&(this.editorPosition=e.click.kwdIndex,this.editorInstead=!0,o=this._getClickedSymbolPos(e.click)),this.editorInstead&&this.value&&this.editorPosition<this.value.length&&(this.editorValue=this.value[this.editorPosition]),this.selectedKeywords.clear(),this.$nextTick((function(){var e=Array.isArray(t.$refs.editor)?t.$refs.editor[0]:t.$refs.editor;e&&(e.focus(),null!==o&&e.setCursor(o))}))},_getClickedSymbolPos:function(e){if(!e.kwdElement)return 0;if(!e.kwdElement.cloneNode)return 0;if(!this.$refs.canvas)return 0;var t=e.kwdElement.cloneNode(!0),o=t.querySelector(".ImsKeywordBox-keyword");if(!o)return 0;var i=e.x-e.kwdBounds.left,s=o.textContent.split("");o.innerHTML="",this.$refs.canvas.appendChild(t);var n,r=t.getBoundingClientRect(),a=0,l=0,d=p(s);try{for(d.s();!(n=d.n()).done;){var c=n.value,u=window.document.createElement("span");u.textContent=c,o.appendChild(u);var h=u.getBoundingClientRect();if(h.left+h.width/2-r.left>i)break;(!this.separatorComp.inside||!this.separatorComp.before||l>=this.separatorComp.text.length)&&a++,l++}}catch(e){d.e(e)}finally{d.f()}return g(t),a},_onContextMenu:function(e){var t=this;this.contextMenuContext&&this.contextMenuContext.destroy(),this.contextMenuContext=new C(this,e,(function(){return t.contextMenuContext=null}))},_getKeywordClasses:function(e,t){var o=null===this.dragKeywordPosition&&this.focused,i=o&&this.cursorPositionRaw===t&&!this.cursorPositionAfter||this.dragKeywordPosition===t&&this.dragKeywordIsBegin||-1===this.dragKeywordPosition&&0===t,s=o&&this.cursorPositionRaw===t+1&&(this.value&&t===this.value.length-1||this.cursorPositionAfter)||this.dragKeywordPosition===t&&!this.dragKeywordIsBegin,n={"state-cursor-before":i,"state-cursor-after":s,"state-cursor-blink":(i||s)&&o,"state-duplicate":this.highlightDuplicated&&this.highlightDuplicated.hasOwnProperty(e),"state-confirm-delete":this.confirmDeleteIndex===t};if(this.getKeywordClasses){var r=this.getKeywordClasses(e,t);r&&("string"==typeof r?n[r]=!0:Array.isArray(r)?r.forEach((function(e){return n[e]=!0})):Object.assign(n,r))}return n},emitValue:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&this.historyController&&this.historyController.push(e),this.$emit(this.emitValueEvent,e)},_editorCommit:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!(this.editorPosition<0)){var o=this.editorValue?this.editorValue.trim():"";return this.cursorPosition=this.editorPosition,this.editorInstead&&this.selectedKeywords.setSelectedStateByIndex(this.editorPosition,!0,!1),this.pasteCommand(o,e,t),this.focus(),this.editorPosition=-1,o}},_editorCommand:function(e){var t=this;switch(e.command){case"commit":this._editorCommit();break;case"move":var o=this.editorPosition;if(e.dir<0){if(this.editorPosition<=0)return;o--}else{if(!this.value||this.editorPosition>=this.value.length)return;o++}this._editorCommit(),this.cursorPosition=o,this.openEditor({instead:!0,cursorAt:e.cursorAt});break;case"delSep":if(!this.value)return;var i=this.editorPosition;if(e.dir<0){if(this.editorPosition<=0)return;i--}else if(!this.value||this.editorPosition>=this.value.length)return;var s=this.value,n=this._editorCommit(s,(function(e){return s=e})),r=s[i],a=n?s[i+1]:"",l=n||e.dir<0?r.length:0;this.cursorPosition=i;var d=h(s);n&&d.splice(i+1,1),d[i]=r+a,this.emitValue(d),this.$nextTick((function(){t.openEditor({instead:!0,cursorAt:l})}))}},_showBetweenSeparatorBefore:function(e){return!!this.value&&(!this.separatorComp.isNewLine&&!(!this.separatorComp.before||0===e&&this.separatorComp.inside))},_showBetweenSeparatorAfter:function(e){if(!this.value)return!1;if(this.separatorComp.isNewLine)return!1;var t=this.editorPosition===this.value.length;return!(this.separatorComp.before&&(!t||e!==this.value.length-1))&&(e<this.value.length-1||t)},_showInsideSeparatorBefore:function(e){return!!this.value&&(!this.separatorComp.isNewLine&&(!!this.separatorComp.inside&&!!this.separatorComp.before))},_showInsideSeparatorAfter:function(e){return!!this.value&&(!this.separatorComp.isNewLine&&(!!this.separatorComp.inside&&!this.separatorComp.before))},_onDeleteKeywordButtonClick:function(e){this.isMobile&&this.confirmDeleteIndex!==e?(this.confirmDeleteIndex=e,this.selectedKeywords.setSelectedStateByIndex(e,!0)):(this.deleteKeywordByIndex(e),this.confirmDeleteIndex=null)}},created:function(){this.historyController&&this.historyController.init(this,this.value)},mounted:function(){this.$refs.scroller&&(this.$refs.scroller.scrollTop=this.scrollY),this.cursorPosition=this.value?this.value.length:0,this.isMobile=K("mobile")},destroyed:function(){this.interactionContext&&this.interactionContext.destroy(),this.contextMenuContext&&this.contextMenuContext.destroy()},watch:{value:function(){this.selectedKeywords.setValue(this.value),this.interactionContext&&this.interactionContext.invalidateCache()},historyController:function(){this.historyController&&this.historyController.init(this,this.value)},scrollY:function(){this.$refs.scroller&&(this.$refs.scroller.scrollTop=this.scrollY)}}},void 0,!1,void 0,!1,B,void 0,void 0),$=function(e){$.installed||($.installed=!0,e.component("ImsKeywordBox",D))},T={install:$},M=null;return"undefined"!=typeof window?M=window.Vue:"undefined"!=typeof global&&(M=global.Vue),M&&M.use(T),D.install=$,e.default=D,e}({});