var ImsKeywordBox=function(e){"use strict";function t(e,t,o,i,n,s,r){try{var a=e[s](r),d=a.value}catch(e){return void o(e)}a.done?t(d):Promise.resolve(d).then(i,n)}function o(e){return function(){var o=this,i=arguments;return new Promise((function(n,s){var r=e.apply(o,i);function a(e){t(r,n,s,a,d,"next",e)}function d(e){t(r,n,s,a,d,"throw",e)}a(void 0)}))}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function a(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,i)}return o}function d(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?a(Object(o),!0).forEach((function(t){r(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||c(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){if(e){if("string"==typeof e)return u(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,i=new Array(t);o<t;o++)i[o]=e[o];return i}function h(e,t){var o;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(o=c(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,r=!0,a=!1;return{s:function(){o=e[Symbol.iterator]()},n:function(){var e=o.next();return r=e.done,e},e:function(e){a=!0,s=e},f:function(){try{r||null==o.return||o.return()}finally{if(a)throw s}}}}var f=function(){function e(t){i(this,e),this.selection={},this.count=0,this._lastActiveKeyword=null,this._lastActiveKeywordIndex=-1,this.value=[],this.setValue(t)}return s(e,[{key:"getIndexOfKeyword",value:function(e){return this.value.indexOf(e)}},{key:"getFirstSelectedIndex",value:function(){if(!this.value)return-1;for(var e=0;e<this.value.length;e++){var t=this.value[e];if(this.selection.hasOwnProperty(t)&&this.selection[t])return e}return-1}},{key:"getLastSelectedIndex",value:function(){if(!this.value)return-1;for(var e=this.value.length-1;e>=0;e--){var t=this.value[e];if(this.selection.hasOwnProperty(t)&&this.selection[t])return e}return-1}},{key:"setValue",value:function(e){var t=this;if(this.value=e||[],e){var o={},i=0;e.forEach((function(e,n){t.selection.hasOwnProperty(e)&&t.selection[e]&&(o[e]=!0,i++)})),this.selection=o,this.count=i}}},{key:"isSelected",value:function(e){return this.selection.hasOwnProperty(e)&&this.selection[e]}},{key:"isSelectedByIndex",value:function(e){return!(e>=this.value.length||e<0)&&this.isSelected(this.value[e])}},{key:"selectKeyword",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e){var o=t?d({},this.selection):{};o[e]=!0,this.selection=o,this.count=t?this.count+1:1}}},{key:"selectKeywordsArray",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(0!==e.length){var i=o?d({},this.selection):{};o||(this.count=0),e.forEach((function(e){i[e]||(i[e]=!0,t.count++)})),this.selection=i}}},{key:"clear",value:function(){0!==this.count&&(this.selection={},this.count=0)}},{key:"selectAll",value:function(){var e,t={},o=h(this.value);try{for(o.s();!(e=o.n()).done;){t[e.value]=!0}}catch(e){o.e(e)}finally{o.f()}this.selection=t,this.count=this.value.length}},{key:"deselectKeyword",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&(t?this.selection.hasOwnProperty(e)&&this.selection[e]&&(this.selection=d(d({},this.selection),{},r({},e,!1)),this.count--):(this.selection={},this.count=0))}},{key:"setSelectedState",value:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t?this.selectKeyword(e,o):this.deselectKeyword(e,o)}},{key:"setSelectedStateByIndex",value:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e>=this.value.length||e<0||(t?this.selectKeyword(this.value[e],o):this.deselectKeyword(this.value[e],o))}},{key:"selectRangeByIndexes",value:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e>t){var i=e;e=t,t=i}for(var n=o?d({},this.selection):{},s=o?this.count:0,r=Math.max(e,0);r<=Math.min(t,this.value.length-1);r++)n.hasOwnProperty(this.value[r])&&n[this.value[r]]||(n[this.value[r]]=!0,s++);this.selection=n,this.count=s}},{key:"getSiblingKeyword",value:function(e,t){return 0===t?e<this.value.length&&e>=0?this.value[e]:null:t>0?e<this.value.length-1?this.value[e+1]:null:e>0?this.value[e-1]:null}},{key:"getActiveSiblingKeyword",value:function(e){return this.getSiblingKeyword(this.lastActiveKeywordIndex,e)}},{key:"getSelectionAsArray",value:function(){var e=this;return 0===this.count?[]:this.value.filter((function(t){return e.selection.hasOwnProperty(t)&&e.selection[t]}))}},{key:"lastActiveKeyword",get:function(){return this._lastActiveKeyword},set:function(e){this._lastActiveKeyword=e,e?(this._lastActiveKeywordIndex=this.getIndexOfKeyword(e),this._lastActiveKeywordIndex<0&&(this._lastActiveKeyword=null)):this._lastActiveKeywordIndex=-1}},{key:"lastActiveKeywordIndex",get:function(){return this._lastActiveKeywordIndex},set:function(e){this.value.length>0?(e<0?e=0:e>this.value.length-1&&(e=this.value.length-1),this._lastActiveKeywordIndex=e,this._lastActiveKeyword=this.value[e]):(this._lastActiveKeywordIndex=-1,this._lastActiveKeyword=null)}}]),e}();function y(e,t){if(!e)return!1;if(void 0!==e.classList){if(e.classList.contains(t))return!0}else{if(void 0===e.className)return!1;if(e.className===t)return!0;if(e.className.split(/\s/).some((function(e){return e.trim()===t})))return!0}return!1}function p(e,t){if("undefined"==typeof window)return null;for(;e;){if(e===document)return null;if(y(e,t))return e;e=e.parentNode}return null}function w(e){e&&(void 0!==e.remove?e.remove():e.parentNode.removeChild(e))}var v=null;function m(e){if(!window||!window.navigator)return!1;if(!v){var t=window.navigator.userAgent,o=/Edge\/|Trident\/|MSIE /.test(t),i=!o&&/AppleWebKit/.test(t)&&/Mobile\/\w+/.test(t),n=i||/mac/i.test(window.navigator.platform),s=/apple/i.test(window.navigator.vendor);v={ie:o,mac:n,safari:s,ios:i}}return v[e]}function g(e){return m("mac")?e.metaKey:e.ctrlKey}var x=function(){function e(t,o,n,s){if(i(this,e),!t.$el)throw new Error("ImsKeywordBox interaction context: Master component is not mounted");this.isDragging=s,this.component=t,this.startTime=Date.now(),this.startElement=o.target,this.destroyed=n,this.draggingMyKeywords=[],this.draggingCanvas=null,this.invalidateCache(),this.resetEventHandlers(this.isDragging,!1),this.startPoint=this.getMousePointInfo(o),this.curPoint=this.startPoint}return s(e,[{key:"invalidateCache",value:function(){this._cacheKeywordsElems=null,this._cacheKeywordsBounds={}}},{key:"onMouseEnd",value:function(e){this.curPoint=this.getMousePointInfo(e),this.isDragging?"move"===e.dataTransfer.dropEffect&&this.deleteDraggingMyKeywords():this.startElement===e.target&&this.keywordClick(this.curPoint,e),this.destroy()}},{key:"onMouseUpdate",value:function(e){var t=g(e);if(this.curPoint=this.getMousePointInfo(e),this.isDragging){if(e.dataTransfer.types.includes("text/plain")&&e.preventDefault(),this.component.dragKeywordPosition=this.curPoint.kwdIndex,this.component.dragKeywordIsBegin=!1,this.curPoint.hoverKwdElement){var o=this._getKeywordBounds(this.curPoint.kwdIndex);o&&o.left+o.width/2>e.clientX&&(this.component.dragKeywordIsBegin=!0)}}else if(!this.startPoint.hoverKwdElement){var i=this.startPoint.kwdIndex+this.startPoint.offset;if(this.startPoint.kwdIndex===this.curPoint.kwdIndex)t||(this.component.selectedKeywords.count>0&&this.component.selectedKeywords.clear(),this.component.cursorPosition=i);else{this.component.cursorPosition=-1,i>this.curPoint.kwdIndex&&i--;var n=this.curPoint.kwdIndex;0!==this.curPoint.outside&&n++,this.component.selectedKeywords.lastActiveKeywordIndex=i,this.component.selectedKeywords.selectRangeByIndexes(i,n,t)}}}},{key:"keywordClick",value:function(e,t){if(!e.delButton){var o=g(t),i=e.kwdIndex,n=-1,s=-1===this.component.cursorPosition?this.component.selectedKeywords.lastActiveKeywordIndex:this.component.cursorPosition;if(!e.hoverKwdElement){if(!t.shiftKey&&o)return;t.shiftKey?s>e.kwdIndex&&i++:(i=-1,n=e.kwdIndex+e.offset)}var r=0===t.button;if(2===t.button&&(r=this.component.selectedKeywords.count>0),i>=0&&r){if(t.shiftKey)-1!==this.component.cursorPosition&&(i<s&&s--,this.component.selectedKeywords.lastActiveKeywordIndex=s),this.component.selectedKeywords.selectRangeByIndexes(s,i,o);else{var a=this.component.selectedKeywords.isSelectedByIndex(i);if(o)this.component.selectedKeywords.setSelectedStateByIndex(i,!a,!0);else if(a){if(0===t.button){var d={x:t.clientX,y:t.clientY,kwdIndex:this.curPoint?this.curPoint.kwdIndex:null,kwdElement:null,kwdBounds:null};d.kwdIndex>=0&&(d.kwdElement=this._getHoverKwdElement(d.kwdIndex),d.kwdBounds=this._getKeywordBounds(d.kwdIndex)),this.component.openEditor({click:d})}}else this.component.selectedKeywords.setSelectedStateByIndex(i,!0);this.component.selectedKeywords.lastActiveKeywordIndex=i}this.component.cursorPosition=-1}else-1!==n&&(this.component.setCursorPosition(n,1===e.outside),this.component.selectedKeywords.clear())}}},{key:"getMousePointInfo",value:function(e){var t={kwdIndex:-1,offset:1,hoverKwdElement:null,outside:0,delButton:!1};if(0===this.component.value.length)return t;var o=e.target;y(o,"ImsKeywordBox-keyword-delete")&&(t.delButton=!0,(o=p(o,"ImsKeywordBox-keyword"))||(o=e.target)),y(o,"ImsKeywordBox-keyword")&&((o=p(o,"ImsKeywordBox-keyword-wrapper"))||(o=e.target));var i=y(o,"ImsKeywordBox-keyword-wrapper"),n=y(o,"ImsKeywordBox-separator");return i||n?(t.kwdIndex=parseInt(o.dataset.kwdInd),i?(t.hoverKwdElement=i,t.offset=0):t.offset=1,t):this._findMousePointInfoByCoords(e.clientX,e.clientY)}},{key:"_findMousePointInfoByCoords",value:function(e,t){var o={kwdIndex:this.component.value.length-1,offset:1,hoverKwdElement:null,outside:1},i=this._getLastKeywordBounds();if(!i)return o;if(t>i.bottom||t>i.top&&e>i.right)return o;var n=this._getFirstKeywordBounds();if(!n)return o;var s=e<i.left;if(t<n.bottom&&s)return o.kwdIndex=-1,o.offset=1,o.outside=-1,o;var r=t-n.top,a=Math.floor(r/n.height);return o.kwdIndex=this._findKeywordEdgeIndex(a,s?-1:1,n.top,n.height)+(s?-1:0),o.offset=1,o.outside=s?-1:1,o}},{key:"_findKeywordEdgeIndex",value:function(e,t,o,i){for(var n=0,s=this.component.value.length-1;n<=s;){var r=Math.floor((s+n)/2),a=this._getKeywordBounds(r),d=a?Math.round((a.top-o)/i):0,l=this._getKeywordBounds(r+t),c=l?Math.round((l.top-o)/i):d+t;if(d===e&&c===e+t)return r;e<d||e===d&&-1===t?s=r-1:n=r+1}return n}},{key:"_getHoverKwdElement",value:function(e){if(!this._cacheKeywordsElems){if(!this.component.$refs.canvas)return null;this._cacheKeywordsElems=this.component.$refs.canvas.querySelectorAll(".ImsKeywordBox-keyword-wrapper")}return e<0||e>=this._cacheKeywordsElems.length?null:this._cacheKeywordsElems[e]}},{key:"_getKeywordBounds",value:function(e){if(!this._cacheKeywordsBounds.hasOwnProperty(e)){var t=this._getHoverKwdElement(e);if(!t)return null;this._cacheKeywordsBounds[e]=t.getBoundingClientRect()}return this._cacheKeywordsBounds[e]}},{key:"_getLastKeywordBounds",value:function(){return this._getKeywordBounds(this.component.value.length-1)}},{key:"_getFirstKeywordBounds",value:function(){return this._getKeywordBounds(0)}},{key:"destroy",value:function(){this.component.dragKeywordPosition=null,this.component.dragKeywordIsBegin=!1,this.resetEventHandlers(this.isDragging,!0),w(this.draggingCanvas),this.destroyed&&this.destroyed()}},{key:"makeDragging",value:function(){this.isDragging||(this.isDragging=!0,this.resetEventHandlers(!1,!1))}},{key:"onDragLeave",value:function(){this.component.dragKeywordPosition=null,this.component.dragKeywordIsBegin=!1}},{key:"resetEventHandlers",value:function(e,t){var o=this;this._onMouseEndHandler&&(window.removeEventListener(e?"dragend":"mouseup",this._onMouseEndHandler),this._onMouseEndHandler=null),this._onMouseUpdateHandler&&(this.component.$el&&this.component.$el.removeEventListener(e?"dragover":"mousemove",this._onMouseUpdateHandler),this._onMouseUpdateHandler=null),this._invalidateCacheHandler&&(window.removeEventListener("resize",this._invalidateCacheHandler,{passive:!0}),window.removeEventListener("scroll",this._invalidateCacheHandler,{passive:!0}),this.component.$refs.scroller&&this.component.$refs.scroller.removeEventListener("scroll",this._invalidateCacheHandler),this._invalidateCacheHandler=null),e&&(this.component.$el.removeEventListener("dragleave",this._onDragLeaveHandler),this._onDragLeaveHandler=null),t||(this._onMouseEndHandler=function(e){return o.onMouseEnd(e)},this._onMouseUpdateHandler=function(e){return o.onMouseUpdate(e)},this._invalidateCacheHandler=function(e){return o.invalidateCache()},window.addEventListener(this.isDragging?"dragend":"mouseup",this._onMouseEndHandler),this.component.$el.addEventListener(this.isDragging?"dragover":"mousemove",this._onMouseUpdateHandler),window.addEventListener("resize",this._invalidateCacheHandler,{passive:!0}),window.addEventListener("scroll",this._invalidateCacheHandler,{passive:!0}),this.component.$refs.scroller.addEventListener("scroll",this._invalidateCacheHandler),this.isDragging&&(this._onDragLeaveHandler=function(e){return o.onDragLeave(e)},this.component.$el.addEventListener("dragleave",this._onDragLeaveHandler)))}},{key:"deleteDraggingMyKeywords",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,o=void 0!==t?t:this.component.value;if(this.draggingMyKeywords.length>0){var i=-1;o=[];for(var n=0;n<this.component.value.length;n++){var s=this.component.value[n];this.draggingMyKeywords.indexOf(s)>=0?-1===i&&(i=n):o.push(s)}this.draggingMyKeywords=[],this.component.cursorPosition=i,e&&this.component.$emit("change",o)}return o}}]),e}(),K=function(){function e(t,o,n){i(this,e),this.component=t,this.destroyed=n,this._moveTextareaToCursor(o),this.selectAllDetectTimeout=null,this.selectAllTry=0,this._runHideTimeout()}return s(e,[{key:"_runHideTimeout",value:function(){var e=this;this._hideTimeout=setTimeout((function(){e._hideTimeout=null,e._hideTextarea()}),100)}},{key:"_moveTextareaToCursor",value:function(e){if(this.component.$refs.textArea){var t=this.component.$el.getBoundingClientRect();this.component.$refs.textArea.style.left=e.clientX-t.left-5+"px",this.component.$refs.textArea.style.top=e.clientY-t.top-5+"px",this.component.$refs.textArea.style.width="10px",this.component.$refs.textArea.style.height="10px",this.component.$refs.textArea.style.zIndex=1e4,this.component.$refs.textArea.focus(),this.component.$refs.textArea.value="";var o=this.component.getSelectionsAsJoinedString();this.component.$refs.textArea.value=o+" ",this.component.$refs.textArea.setSelectionRange(0,o.length),this.selectAllTry=0,this._detectSelectAll()}}},{key:"_detectSelectAll",value:function(){var e=this;this.selectAllTry>=10||(this.selectAllTry++,setTimeout((function(){e.component.$refs.textArea&&(e.component.$refs.textArea.selectionEnd===e.component.$refs.textArea.value.length?e.component.selectAll():e._detectSelectAll())}),500))}},{key:"_hideTextarea",value:function(){this.component.$refs.textArea&&(this.component.$refs.textArea.style.left=0,this.component.$refs.textArea.style.top=0,this.component.$refs.textArea.style.width=0,this.component.$refs.textArea.style.height=0,this.component.$refs.textArea.style.zIndex=-2)}},{key:"destroy",value:function(){this._hideTimeout&&clearTimeout(this._hideTimeout),this.selectAllDetectTimeout&&clearTimeout(this.selectAllDetectTimeout),this.destroyed&&this.destroyed(),this.component.$refs.textArea&&(this.component.$refs.textArea.value="")}}]),e}();function k(e){return I.apply(this,arguments)}function I(){return(I=o(regeneratorRuntime.mark((function e(t){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.clipboard.writeText(t);case 3:return e.abrupt("return",e.sent);case 6:e.prev=6,e.t0=e.catch(0),(o=document.createElement("textarea")).style.position="fixed",o.style.top="0",o.style.left="0",o.style.width="10px",o.style.height="10px",document.body.appendChild(o),o.value=t,o.focus(),o.setSelectionRange(0,o.value.length),document.execCommand("copy"),document.body.removeChild(o);case 20:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}function b(e,t,o,i,n,s,r,a,d,l){"boolean"!=typeof r&&(d=a,a=r,r=!1);const c="function"==typeof o?o.options:o;let u;if(e&&e.render&&(c.render=e.render,c.staticRenderFns=e.staticRenderFns,c._compiled=!0,n&&(c.functional=!0)),i&&(c._scopeId=i),s?(u=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,d(e)),e&&e._registeredComponents&&e._registeredComponents.add(s)},c._ssrRegister=u):t&&(u=r?function(e){t.call(this,l(e,this.$root.$options.shadowRoot))}:function(e){t.call(this,a(e))}),u)if(c.functional){const e=c.render;c.render=function(t,o){return u.call(o),e(t,o)}}else{const e=c.beforeCreate;c.beforeCreate=e?[].concat(e,u):[u]}return o}const C="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());function _(e){return(e,t)=>function(e,t){const o=C?t.media||"default":e,i=P[o]||(P[o]={ids:new Set,styles:[]});if(!i.ids.has(e)){i.ids.add(e);let o=t.source;if(t.map&&(o+="\n/*# sourceURL="+t.map.sources[0]+" */",o+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t.map))))+" */"),i.element||(i.element=document.createElement("style"),i.element.type="text/css",t.media&&i.element.setAttribute("media",t.media),void 0===B&&(B=document.head||document.getElementsByTagName("head")[0]),B.appendChild(i.element)),"styleSheet"in i.element)i.styles.push(o),i.element.styleSheet.cssText=i.styles.filter(Boolean).join("\n");else{const e=i.ids.size-1,t=document.createTextNode(o),n=i.element.childNodes;n[e]&&i.element.removeChild(n[e]),n.length?i.element.insertBefore(t,n[e]):i.element.appendChild(t)}}}(e,t)}let B;const P={};var A=b({render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"ImsKeywordBox",class:{"state-focus":e.focused},on:{mousedown:e._onMouseDown,dragstart:e._onDragStart,dragenter:e._onDragEnter,drop:e._onDrop,contextmenu:e._onContextMenu}},[o("textarea",{ref:"textArea",staticClass:"ImsKeywordBox-textarea",attrs:{autocorrect:"off",autocapitalize:"off",spellcheck:"false"},on:{keydown:e._onTextareaKeyDown,blur:e._onTextareaBlur,focus:e._onTextareaFocus,paste:e._onTextareaPaste,copy:e._onTextareaCopy,cut:e._onTextareaCut,input:e._onTextareaInput}}),e._v(" "),o("div",{ref:"scroller",staticClass:"ImsKeywordBox-scroller",on:{"&scroll":function(t){return e.emitScroll(t)}}},[o("div",{ref:"canvas",staticClass:"ImsKeywordBox-canvas"},[e.value&&e.value.length>0?[o("span",{staticStyle:{"padding-right":"0.1px"}},[e._l(e.value,(function(t,i){return[o("span",{class:e.separatorIsNewLine?"ImsKeywordBox-line":"ImsKeywordBox-inline"},[e.editorPosition===i?[o("ims-keyword-box-editor",{ref:"editor",refInFor:!0,staticClass:"ImsKeywordBox-editor",on:{blur:e._editorCommit,command:e._editorCommand},model:{value:e.editorValue,callback:function(t){e.editorValue=t},expression:"editorValue"}}),e.separatorIsNewLine||e.editorInstead?e._e():o("span",{staticClass:"ImsKeywordBox-separator",attrs:{"data-kwd-ind":i}},[e._v(e._s(e.separatorCharacter))])]:e._e(),e.editorPosition===i&&e.editorInstead?e._e():o("span",{staticClass:"ImsKeywordBox-keyword-wrapper",class:{"state-highlighted":e.selectedKeywords.isSelected(t)},attrs:{draggable:"","data-kwd-ind":i}},[o("span",{staticClass:"ImsKeywordBox-keyword",class:e._getKeywordClasses(t,i)},[e._v(e._s(t)),e.showDeleteButton?o("span",{staticClass:"ImsKeywordBox-keyword-delete",on:{click:function(t){return e.deleteKeywordByIndex(i)}}}):e._e()])]),(i<e.value.length-1||e.editorPosition===e.value.length)&&!e.separatorIsNewLine?o("span",{staticClass:"ImsKeywordBox-separator",attrs:{"data-kwd-ind":i}},[e._v(e._s(e.separatorCharacter))]):e._e()],2)]}))],2)]:[o("div",{staticClass:"ImsKeywordBox-stub",class:{"state-cursor-after":0===e.cursorPosition&&e.focused||-1===e.dragKeywordPosition,"state-cursor-blink":0===e.cursorPosition&&e.focused&&null===e.dragKeywordPosition}})],e._v(" "),!e.value.length&&0===e.editorPosition||e.editorPosition===e.value.length?o("ims-keyword-box-editor",{ref:"editor",staticClass:"ImsKeywordBox-editor",on:{blur:e._editorCommit,command:e._editorCommand},model:{value:e.editorValue,callback:function(t){e.editorValue=t},expression:"editorValue"}}):e._e()],2)])])},staticRenderFns:[]},(function(e){e&&e("data-v-b8d2f1ec_0",{source:".ImsKeywordBox{border:1px solid #ccc;border-radius:4px;overflow:auto;position:relative;padding:0 6px;cursor:text}.ImsKeywordBox-scroller{height:100%;overflow-x:hidden;position:relative}.ImsKeywordBox-canvas{display:block;padding:4px 4px 4px 4px;line-height:2em;position:relative;user-select:none;outline:0;min-height:100%;box-sizing:border-box}.ImsKeywordBox-keyword-wrapper{white-space:nowrap;display:inline-block}.ImsKeywordBox-keyword-wrapper.state-highlighted{position:relative}.ImsKeywordBox-keyword-wrapper.state-highlighted>.ImsKeywordBox-keyword{cursor:text}.ImsKeywordBox-keyword-wrapper.state-highlighted:before{content:\"\";position:absolute;width:100%;height:2em;background:#e9e9e9;left:-4px;top:0;padding-left:4px;padding-right:5px}.ImsKeywordBox.state-focus .ImsKeywordBox-scroller>.ImsKeywordBox-canvas .ImsKeywordBox-keyword-wrapper.state-highlighted:before{background:#d7d4f0}.ImsKeywordBox-keyword-wrapper.state-highlighted{background:#faa}.ImsKeywordBox-textarea{width:0;height:0;overflow:hidden;padding:0;display:block;resize:none;position:absolute;background:0 0;border:none;top:0;left:0;color:transparent;outline:0}.ImsKeywordBox-textarea::-moz-selection,.ImsKeywordBox-textarea::selection{color:transparent}.ImsKeywordBox-keyword{padding:2px 7px;border:1px solid #ccc;border-radius:4px;line-height:1.4em;display:inline-block;white-space:nowrap;cursor:default;background-color:rgba(250,250,250,.7);position:relative}.ImsKeywordBox-keyword.state-cursor-after:after,.ImsKeywordBox-keyword.state-cursor-before:after,.ImsKeywordBox-stub.state-cursor-after:after,.ImsKeywordBox-stub.state-cursor-before:after{content:\"\";display:block;width:1px;height:29px;background:#000;position:absolute;top:-2px;pointer-events:none}.ImsKeywordBox-keyword.state-cursor-after.state-cursor-blink:after,.ImsKeywordBox-keyword.state-cursor-before.state-cursor-blink:after,.ImsKeywordBox-stub.state-cursor-after.state-cursor-blink:after,.ImsKeywordBox-stub.state-cursor-before.state-cursor-blink:after{animation:ImsKeywordBox-cursor-blink .5s infinite alternate}.ImsKeywordBox-keyword.state-cursor-before:after,.ImsKeywordBox-stub.state-cursor-before:after{left:-5px}.ImsKeywordBox-keyword.state-cursor-after:after{right:-6px}.ImsKeywordBox-keyword.state-duplicate{background-color:#ff9c9c}.ImsKeywordBox-stub{display:inline-block;width:1px;height:1.4em;position:relative}.ImsKeywordBox-stub.state-cursor-after:after{right:0}.ImsKeywordBox-separator{position:relative;display:inline-block;white-space:pre}.ImsKeywordBox-separator:first-child,.ImsKeywordBox-separator:last-child{color:#aaa}.ImsKeywordBox-line{display:block}.ImsKeywordBox-keyword-delete{background:url(\"data:image/svg+xml,%3Csvg viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='m18.011 3.8674-6.0106 6.0106-6.0106-6.0106-2.1212 2.1212 6.0106 6.0106-6.0106 6.0106 2.1212 2.1212 6.0106-6.0106 6.0106 6.0106 2.1212-2.1212-6.0106-6.0106 6.0106-6.0106z'/%3E%3C/svg%3E%0A\") no-repeat right center;display:inline-block;width:12px;height:12px;cursor:pointer;background-size:contain;opacity:.5;position:relative;top:1px;margin-left:4px}.ImsKeywordBox-keyword-delete:hover{opacity:1}@keyframes ImsKeywordBox-cursor-blink{0%{opacity:1}49.9%{opacity:1}50%{opacity:0}100%{opacity:0}}",map:void 0,media:void 0})}),{name:"ImsKeywordBox",components:{ImsKeywordBoxEditor:b({render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("span",{staticClass:"ImsKeywordBoxEditor"},[o("input",{ref:"input",staticClass:"ImsKeywordBoxEditor-input",attrs:{type:"text"},domProps:{value:e.rawVal},on:{keydown:e._onKeyDown,blur:e._onBlur,input:function(t){return e._setValue(t.target.value)}}}),e._v(" "),o("span",{ref:"hidden",staticClass:"ImsKeywordBoxEditor-hidden"})])},staticRenderFns:[]},(function(e){e&&e("data-v-41cddd5f_0",{source:".ImsKeywordBoxEditor{position:relative;display:inline-block}.ImsKeywordBoxEditor-hidden,.ImsKeywordBoxEditor-input{outline:0;border:none;font-size:inherit;font-family:inherit;line-height:inherit;white-space:pre;display:block;padding:0;background:0 0}.ImsKeywordBoxEditor-hidden{position:absolute;top:0;left:0;visibility:hidden;box-sizing:content-box;padding-right:5px}",map:void 0,media:void 0})}),{name:"ImsKeywordBoxEditor",props:{value:{}},data:function(){return{rawVal:this.value}},methods:{_updateSize:function(){if(this.$refs.hidden&&this.$refs.input){this.$refs.hidden.textContent=this.rawVal;var e=this.$refs.hidden.getBoundingClientRect();this.$refs.input.style.width=e.width+"px"}},_setValue:function(e){this.rawVal!==e&&(this.rawVal=e,this._updateSize(),this.$emit("input",e))},_onBlur:function(){this.$emit("blur")},setCursor:function(e){this.$refs.input&&this.$refs.input.setSelectionRange(e,e)},focus:function(){this.$refs.input&&this.$refs.input.focus()},blur:function(){this.$refs.blur&&this.$refs.blur.blur()},_onKeyDown:function(e){if(this.$refs.input)switch(e.key){case"Enter":case"Escape":e.preventDefault(),this.$emit("command",{command:"commit"});break;case"Tab":e.preventDefault(),this.$emit("command",{command:"move",dir:e.shiftKey?-1:1,cursorAtBegin:!0});break;case"ArrowLeft":this.$refs.input.selectionStart===this.$refs.input.selectionEnd&&0===this.$refs.input.selectionStart&&(e.preventDefault(),this.$emit("command",{command:"move",dir:-1,cursorAtBegin:!1}));break;case"ArrowRight":this.$refs.input.selectionStart===this.$refs.input.selectionEnd&&this.$refs.input.selectionStart===this.rawVal.length&&(e.preventDefault(),this.$emit("command",{command:"move",dir:1,cursorAtBegin:!0}))}}},mounted:function(){this._updateSize()},watch:{value:function(){this.rawVal!==this.value&&(this.rawVal=this.value,this._updateSize())}}},void 0,!1,void 0,!1,_,void 0,void 0)},props:{value:{},showDeleteButton:{type:Boolean,default:!0},separator:{type:String,default:", "},preprocessKeyword:{type:Function,default:null},scrollY:{type:Number,default:0},splittingRegexp:{type:RegExp,default:function(){return/[;,\r\n]/}},getKeywordClasses:{type:Function,default:null},handleExceptions:{type:Function,default:null},emitValueEvent:{type:String,default:"input"},customizeMultiKeywordDraggingCanvas:{type:Function,default:null}},data:function(){return{selectedKeywords:new f(this.value),cursorPositionRaw:-1,cursorPositionAfter:!1,interactionContext:null,contextMenuContext:null,highlightDuplicated:null,dragKeywordPosition:null,dragKeywordIsBegin:!1,muteNativeClipboardEventsTime:Date.now()-100,focused:!1,editorPosition:-1,editorInstead:!1,editorValue:null}},computed:{cursorPosition:{get:function(){return this.cursorPositionRaw},set:function(e){this.cursorPositionRaw=e,this.cursorPositionAfter=!1}},separatorIsNewLine:function(){return"\r\n"===this.separator},separatorCharacter:function(){return this.separator}},methods:{setCursorPosition:function(e,t){this.cursorPositionRaw=e,this.cursorPositionAfter=t},deleteSelectedKeywords:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.value;if(this.selectedKeywords.count>0){var o=-1;t=[];for(var i=0;i<this.value.length;i++){var n=this.value[i];this.selectedKeywords.isSelected(n)?-1===o&&(o=i):t.push(n)}this.selectedKeywords.clear(),this.cursorPosition=o,e&&this._emitValue(t)}return t},eraseEofCommand:function(){var e=this.selectedKeywords.count>0?this.selectedKeywords.getFirstSelectedIndex():this.cursorPosition;e<0&&(e=0);var t=this.value.slice(0,e);this.cursorPosition=t.length,this.selectedKeywords.clear(),this._emitValue(t)},clearCommand:function(){this.selectedKeywords.clear(),this.cursorPosition=-1,this._emitValue([])},deleteWordFromCursor:function(e){if(this.cursorPosition>=0){var t=l(this.value);t.splice(this.cursorPosition+e,1),this.cursorPosition=Math.max(this.cursorPosition+e,0),this.selectedKeywords.clear(),this._emitValue(t)}},getSelectionsAsJoinedString:function(){return this.selectedKeywords.getSelectionAsArray().join(this.separatorCharacter)},copyCommand:function(){var e=this;return o(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!(e.selectedKeywords.count>0)){t.next=4;break}return t.next=4,k(e.getSelectionsAsJoinedString());case 4:t.next=10;break;case 6:if(t.prev=6,t.t0=t.catch(0),e.handleExceptions&&e.handleExceptions(t.t0)){t.next=10;break}throw t.t0;case 10:case"end":return t.stop()}}),t,null,[[0,6]])})))()},cutCommand:function(){var e=this;return o(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.selectedKeywords.count>0)){t.next=4;break}return t.next=3,e.copyCommand();case 3:e.deleteSelectedKeywords();case 4:case"end":return t.stop()}}),t)})))()},pasteCommand:function(e){if(e){var t=this.value;this.selectedKeywords.count>0&&(t=this.deleteSelectedKeywords(!1)),this._pasteCommandImpl(this.cursorPosition,t,e)}},selectAll:function(){this.cursorPosition=-1,this.selectedKeywords.selectAll()},focus:function(){this.$refs.textArea&&this.$refs.textArea.focus()},emitScroll:function(){this.$refs.scroller&&this.$emit("update:scrollY",this.$refs.scroller.scrollTop)},_pasteCommandImpl:function(e,t,o){var i=this;if(o){e<0&&(e=0);for(var n=new Set(t),s=new Set,r=o.split(this.splittingRegexp),a=[],c=null,u=0;u<r.length;u++){var h=this.preprocessKeyword?this.preprocessKeyword(r[u]):r[u];if(h&&!s.has(h)){if(s.add(h),n.has(h)){c||(c={}),c[h]=Date.now();var f=t.indexOf(h);if(f<e)continue;(t=t!==this.value?t:l(t)).splice(f,1)}a.push(h)}}if(this.selectedKeywords.clear(),this.cursorPosition=e+a.length,this.selectedKeywords.lastActiveKeywordIndex=this.cursorPosition,0!==a.length||t!==this.value){var y=l(t);y.splice.apply(y,[e,0].concat(a)),this._emitValue(y)}if(c)if(this.highlightDuplicated)this.highlightDuplicated=d(d({},this.highlightDuplicated),c);else{this.highlightDuplicated=c;setTimeout((function e(){if(i.highlightDuplicated){var t=null,o=Date.now()-600;for(var n in i.highlightDuplicated)i.highlightDuplicated.hasOwnProperty(n)&&i.highlightDuplicated[n]>o&&(t||(t={}),t[n]=i.highlightDuplicated[n]);i.highlightDuplicated=t,i.highlightDuplicated&&setTimeout(e,200)}}),200)}return a}},_onMouseDown:function(e){var t=this;p(e.target,"ImsKeywordBox-editor")||(this.$refs.textArea&&setTimeout((function(){t.$refs.textArea&&t.$refs.textArea.focus()}),10),this.interactionContext||(this.interactionContext=new x(this,e,(function(){return t.interactionContext=null}),!1)))},_onTextareaFocus:function(){var e=this;this.focused=!0,setTimeout((function(){document.activeElement===e.$refs.textArea&&(e.focused||e.$emit("focus"))}),100)},_onTextareaBlur:function(){var e=this;this.focused=!1,setTimeout((function(){document.activeElement!==e.$refs.textArea&&e.focused&&e.$emit("blur")}),100)},_onDragStart:function(e){var t=this,o=e.target.dataset.kwdInd;if(void 0!==o&&(this.selectedKeywords.isSelectedByIndex(o)||(this.cursorPosition=-1,this.selectedKeywords.setSelectedStateByIndex(o,!0,!1)),e.dataTransfer.setData("text/plain",this.getSelectionsAsJoinedString()),this.interactionContext?this.interactionContext.isDragging||this.interactionContext.makeDragging():this.interactionContext=new x(this,e,(function(){return t.interactionContext=null}),!0),this.interactionContext.draggingMyKeywords=this.selectedKeywords.getSelectionAsArray(),this.selectedKeywords.count>1)){var i=document.createElement("canvas");if(i.style.position="absolute",i.style.left="-100%",document.body.append(i),this.customizeMultiKeywordDraggingCanvas)this.customizeMultiKeywordDraggingCanvas(i,this.selectedKeywords);else{var n=i.getContext("2d");i.width=24,i.height=15,n.fillStyle="#d7d4f0",n.fillRect(0,0,i.width,i.height),n.fillStyle="#000",n.font="12px "+getComputedStyle(this.$el).fontFamily,n.textBaseline="top",n.textAlign="center",n.fillText(this.selectedKeywords.count,12,3)}e.dataTransfer.setDragImage(i,-20,-10),this.interactionContext.draggingCanvas=i}},_onDragEnter:function(e){var t=this;p(e.target,"ImsKeywordBox-editor")||(e.dataTransfer.types.includes("text/plain")&&e.preventDefault(),this.interactionContext?this.interactionContext.isDragging||this.interactionContext.makeDragging():this.interactionContext=new x(this,e,(function(){return t.interactionContext=null}),!0))},_onDrop:function(e){if(!p(e.target,"ImsKeywordBox-editor")){var t=e.dataTransfer.getData("text/plain");e.preventDefault();var o=this.value,i=o[this.dragKeywordPosition];if(this.editorPosition>=0&&(this.editorInstead&&o&&(o=l(o)).splice(this.editorPosition,1),this.editorPosition=-1),this.interactionContext){if(this.interactionContext.draggingMyKeywords.indexOf(i)>=0){var n=new Set;this.interactionContext.draggingMyKeywords.forEach((function(e,t){n.add(e)}));for(var s=null,r=0,a=!1,d=0;d<this.value.length;d++)n.has(this.value[d])?(null===s&&(s=d,r++),a||this.value[d]!==i||(this.dragKeywordPosition=s-1,this.dragKeywordIsBegin=!1,i=this.dragKeywordPosition>=0?this.value[this.dragKeywordPosition]:null,a=!0)):s=null;if(1===r)return void this.interactionContext.destroy()}o=this.interactionContext.deleteDraggingMyKeywords(!1,o)}var c=i?o.indexOf(i):this.dragKeywordPosition;c<0&&(c=this.dragKeywordPosition);var u=this._pasteCommandImpl(c+(this.dragKeywordIsBegin?0:1),o,t);this.cursorPosition=-1,this.selectedKeywords.selectKeywordsArray(u),this.interactionContext&&this.interactionContext.destroy()}},_onTextareaKeyDown:function(e){var t,o=this,i=!1,n=!(t=e).key||t.altKey||t.ctrlKey||t.metaKey?null:"Spacebar"===t.key?" ":1===t.key.length||t.key.length>1&&/[^a-zA-Z0-9]/.test(t.key)?t.key:null,s=!!n,r=g(e);switch(e.key){case"Shift":case"Alt":case"AltGraph":case"Control":case"Tab":case"CapsLock":case"Fn":case"FnLock":case"Hyper":case"Meta":case"OS":case"NumLock":case"ScrollLock":case"Scroll":case"Super":case"Symbol":case"SymbolLock":return;case"PageUp":case"PageDown":case"Insert":s=!0;break;case"ArrowUp":case"ArrowDown":if(this.selectedKeywords.count>0&&!e.shiftKey){var a="ArrowDown"===e.key?1:-1;this.cursorPosition=a>0?this.selectedKeywords.getLastSelectedIndex()+1:this.selectedKeywords.getFirstSelectedIndex(),this.selectedKeywords.clear(),i=!0}break;case"ArrowLeft":case"ArrowRight":s=!0;var d="ArrowRight"===e.key?1:-1;if(this.selectedKeywords.count>0){if(r||e.shiftKey){var l=e.shiftKey,c=this.selectedKeywords.getActiveSiblingKeyword(d);c&&(l&&this.selectedKeywords.isSelected(c)?this.selectedKeywords.deselectKeyword(this.selectedKeywords.lastActiveKeyword,!0):this.selectedKeywords.selectKeyword(c,l),this.selectedKeywords.lastActiveKeywordIndex+=d)}else this.cursorPosition=d>0?this.selectedKeywords.getLastSelectedIndex()+1:this.selectedKeywords.getFirstSelectedIndex(),this.selectedKeywords.clear();i=!0}else if(r){if(e.shiftKey){var u=this.selectedKeywords.getSiblingKeyword(this.cursorPosition,d<0?-1:0);u&&(this.selectedKeywords.selectKeyword(u),this.selectedKeywords.lastActiveKeywordIndex=this.cursorPosition+(d<0?-1:0),this.cursorPosition=-1)}else this.cursorPosition=Math.min(Math.max(this.cursorPosition+d,0),this.value.length);i=!0}else(d<0&&0===this.cursorPosition||d>0&&this.cursorPosition===this.value.length)&&(i=!0);break;case"Clear":this.clearCommand(),i=!0;break;case"eraseEofCommand":this.eraseEofCommand(),i=!0;break;case"End":case"Home":var h="Home"===e.key?0:this.value.length;if(e.shiftKey){var f=this.selectedKeywords.count>0?this.selectedKeywords.lastActiveKeywordIndex:this.cursorPosition;f>h&&0===h&&0===this.selectedKeywords.count&&f--,this.selectedKeywords.selectRangeByIndexes(f,h,!0),this.selectedKeywords.lastActiveKeywordIndex=h,this.cursorPosition=-1}else this.selectedKeywords.clear(),this.cursorPosition=h;i=!0;break;case"Delete":case"Backspace":s=!0,this.selectedKeywords.count>0&&-1===this.cursorPosition?(this.deleteSelectedKeywords(),i=!0):r&&(this.deleteWordFromCursor("Delete"===e.key?0:-1),i=!0);break;default:var y=function(e){if(void 0!==e.code)return e.code;var t={65:"KeyA",67:"KeyC",86:"KeyV",88:"KeyX",89:"KeyY",90:"KeyZ"};return t.hasOwnProperty(e.which)?t[e.which]:null}(e);if("Copy"===e.key||"KeyC"===y&&r)this.muteNativeClipboardEventsTime=Date.now(),this.copyCommand(),i=!0;else if("Cut"===e.key||"KeyX"===y&&r)this.muteNativeClipboardEventsTime=Date.now(),this.cutCommand(),i=!0;else{if("Paste"===e.key||"KeyV"===y&&r)return void(this.$refs.textArea&&(this.$refs.textArea.value=""));"Redo"===e.key||"KeyY"===y&&r||"KeyZ"===y&&r&&e.shiftKey?(this.$emit("redo"),i=!0):"Undo"===e.key||"KeyZ"===y&&r?(this.$emit("undo"),i=!0):"KeyA"===y&&r&&(this.selectAll(),i=!0)}}if(i)e.preventDefault(),this.$nextTick((function(){var e=o.selectedKeywords.count>0?o.selectedKeywords.lastActiveKeywordIndex:o.cursorPosition;if(!(e<0)&&o.$el){var t=o.$el.querySelector('.ImsKeywordBox-keyword-wrapper[data-kwd-ind="'+e+'"]');if(t)if(m("ie")||m("safari")||m("ios")){if(!o.$refs.scroller)return;var i=o.$refs.scroller.getBoundingClientRect(),n=t.getBoundingClientRect();n.bottom<i.top+10?(o.$refs.scroller.scrollTop-=i.top-n.bottom+n.height,o.emitScroll()):n.top>i.bottom-10&&(o.$refs.scroller.scrollTop+=n.top-i.bottom+n.height,o.emitScroll())}else t.scrollIntoView({block:"nearest"})}}));else if(s){var p=this.value;n&&this.selectedKeywords.count>0&&(p=this.deleteSelectedKeywords());var w={keyDownEvent:e};n&&this.cursorPosition===p.length&&p.length>0&&(this.splittingRegexp&&this.splittingRegexp.test(n)||(w.appendSeparator=this.separator)),this.openEditor(w)}},_onTextareaPaste:function(e){if(e.preventDefault(),!(this.muteNativeClipboardEventsTime+100>Date.now())){this.muteNativeClipboardEventsTime=Date.now();var t=(e.originalEvent||e).clipboardData.getData("text/plain");this.pasteCommand(t)}},_onTextareaCopy:function(e){e.preventDefault(),this.muteNativeClipboardEventsTime+100>Date.now()||(this.muteNativeClipboardEventsTime=Date.now(),this.copyCommand())},_onTextareaCut:function(e){e.preventDefault(),this.muteNativeClipboardEventsTime+100>Date.now()||(this.muteNativeClipboardEventsTime=Date.now(),this.cutCommand())},_onTextareaInput:function(e){e.preventDefault();this.value;this.selectedKeywords.count>0&&this.deleteSelectedKeywords(),this.openEditor({put:e.data})},deleteKeywordByIndex:function(e){if(this.value&&!(this.value.length<=e)){var t=l(this.value);t.splice(e,1),this._emitValue(t)}},openEditor:function(e){var t=this;this.editorPosition=this.cursorPosition,this.editorValue=null,this.editorInstead=!!e.instead;var o=e.cursorAtBegin?0:null;if(e.put&&(this.editorValue=e.put),e.keyDownEvent)switch(e.keyDownEvent.key){case"ArrowLeft":this.editorInstead=!0,this.editorPosition--,e.keyDownEvent.preventDefault();break;case"ArrowRight":this.editorInstead=!0,e.keyDownEvent.preventDefault(),o=0;break;case"Delete":this.editorInstead=!0,o=0;break;case"Backspace":this.editorInstead=!0,this.editorPosition--}e.click&&e.click.kwdIndex>=0&&(this.editorPosition=e.click.kwdIndex,this.editorInstead=!0,o=this._getClickedSymbolPos(e.click)),this.editorInstead&&this.value&&this.editorPosition<this.value.length&&(this.editorValue=this.value[this.editorPosition]),this.selectedKeywords.clear(),this.$nextTick((function(){var e=Array.isArray(t.$refs.editor)?t.$refs.editor[0]:t.$refs.editor;e&&(e.focus(),null!==o&&e.setCursor(o))}))},_getClickedSymbolPos:function(e){if(!e.kwdElement)return 0;if(!e.kwdElement.cloneNode)return 0;if(!this.$refs.canvas)return 0;var t=e.kwdElement.cloneNode(!0),o=t.querySelector(".ImsKeywordBox-keyword");if(!o)return 0;var i=e.x-e.kwdBounds.left,n=o.textContent.split("");o.innerHTML="",this.$refs.canvas.appendChild(t);var s,r=t.getBoundingClientRect(),a=0,d=h(n);try{for(d.s();!(s=d.n()).done;){var l=s.value,c=window.document.createElement("span");c.textContent=l,o.appendChild(c);var u=c.getBoundingClientRect();if(u.left+u.width/2-r.left>i)break;a++}}catch(e){d.e(e)}finally{d.f()}return w(t),a},_onContextMenu:function(e){var t=this;this.contextMenuContext&&this.contextMenuContext.destroy(),this.contextMenuContext=new K(this,e,(function(){return t.contextMenuContext=null}))},_getKeywordClasses:function(e,t){var o=null===this.dragKeywordPosition&&this.focused,i=o&&this.cursorPositionRaw===t&&!this.cursorPositionAfter||this.dragKeywordPosition===t&&this.dragKeywordIsBegin||-1===this.dragKeywordPosition&&0===t,n=o&&this.cursorPositionRaw===t+1&&(t===this.value.length-1||this.cursorPositionAfter)||this.dragKeywordPosition===t&&!this.dragKeywordIsBegin;return d({"state-cursor-before":i,"state-cursor-after":n,"state-cursor-blink":(i||n)&&o,"state-duplicate":this.highlightDuplicated&&this.highlightDuplicated.hasOwnProperty(e)},this.getKeywordClasses?this.getKeywordClasses(e,t):{})},_emitValue:function(e){this.$emit(this.emitValueEvent,e)},_editorCommit:function(){if(!(this.editorPosition<0)){var e=this.editorValue?this.editorValue.trim():"";e&&(this.cursorPosition=this.editorPosition,this.editorInstead&&this.selectedKeywords.setSelectedStateByIndex(this.editorPosition,!0,!1),this.pasteCommand(e),this.focus()),this.editorPosition=-1}},_editorCommand:function(e){switch(e.command){case"commit":this._editorCommit();break;case"move":var t=this.editorPosition;if(e.dir<0){if(this.editorPosition<=0)return;t--}else{if(!this.value||this.editorPosition>=this.value.length)return;t++}this._editorCommit(),this.cursorPosition=t,this.openEditor({instead:!0,cursorAtBegin:e.cursorAtBegin})}}},mounted:function(){this.$refs.scroller.scrollTop=this.scrollY,this.cursorPosition=this.value.length},destroyed:function(){this.interactionContext&&this.interactionContext.destroy(),this.contextMenuContext&&this.contextMenuContext.destroy()},watch:{value:function(){this.selectedKeywords.setValue(this.value),this.interactionContext&&this.interactionContext.invalidateCache()}}},void 0,!1,void 0,!1,_,void 0,void 0),E=function(e){E.installed||(E.installed=!0,e.component("ImsKeywordBox",A))},S={install:E},D=null;return"undefined"!=typeof window?D=window.Vue:"undefined"!=typeof global&&(D=global.Vue),D&&D.use(S),A.install=E,e.default=A,e}({});