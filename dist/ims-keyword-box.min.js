var ImsKeywordBox=function(e){"use strict";function t(e,t,i,o,n,r,s){try{var a=e[r](s),l=a.value}catch(e){return void i(e)}a.done?t(l):Promise.resolve(l).then(o,n)}function i(e){return function(){var i=this,o=arguments;return new Promise((function(n,r){var s=e.apply(i,o);function a(e){t(s,n,r,a,l,"next",e)}function l(e){t(s,n,r,a,l,"throw",e)}a(void 0)}))}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}function s(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function a(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function l(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?a(Object(i),!0).forEach((function(t){s(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,o=d(e);if(t){var n=d(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return u(this,i)}}function f(e){return function(e){if(Array.isArray(e))return p(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||y(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){if(e){if("string"==typeof e)return p(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?p(e,t):void 0}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}function v(e,t){var i;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=y(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var o=0,n=function(){};return{s:n,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return s=e.done,e},e:function(e){a=!0,r=e},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw r}}}}var w=function(){function e(t){o(this,e),this.selection={},this.count=0,this._lastActiveKeyword=null,this._lastActiveKeywordIndex=-1,this.value=[],this.setValue(t)}return r(e,[{key:"getIndexOfKeyword",value:function(e){return this.value.indexOf(e)}},{key:"getFirstSelectedIndex",value:function(){if(!this.value)return-1;for(var e=0;e<this.value.length;e++){var t=this.value[e];if(this.selection.hasOwnProperty(t)&&this.selection[t])return e}return-1}},{key:"getLastSelectedIndex",value:function(){if(!this.value)return-1;for(var e=this.value.length-1;e>=0;e--){var t=this.value[e];if(this.selection.hasOwnProperty(t)&&this.selection[t])return e}return-1}},{key:"setValue",value:function(e){var t=this;if(this.value=e||[],e){var i={},o=0;e.forEach((function(e,n){t.selection.hasOwnProperty(e)&&t.selection[e]&&(i[e]=!0,o++)})),this.selection=i,this.count=o}}},{key:"isSelected",value:function(e){return this.selection.hasOwnProperty(e)&&this.selection[e]}},{key:"isSelectedByIndex",value:function(e){return!(e>=this.value.length||e<0)&&this.isSelected(this.value[e])}},{key:"selectKeyword",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e){var i=t?l({},this.selection):{};i[e]=!0,this.selection=i,this.count=t?this.count+1:1}}},{key:"selectKeywordsArray",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(0!==e.length){var o=i?l({},this.selection):{};i||(this.count=0),e.forEach((function(e){o[e]||(o[e]=!0,t.count++)})),this.selection=o}}},{key:"clear",value:function(){0!==this.count&&(this.selection={},this.count=0)}},{key:"selectAll",value:function(){var e,t={},i=v(this.value);try{for(i.s();!(e=i.n()).done;){t[e.value]=!0}}catch(e){i.e(e)}finally{i.f()}this.selection=t,this.count=this.value.length}},{key:"deselectKeyword",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&(t?this.selection.hasOwnProperty(e)&&this.selection[e]&&(this.selection=l(l({},this.selection),{},s({},e,!1)),this.count--):(this.selection={},this.count=0))}},{key:"setSelectedState",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t?this.selectKeyword(e,i):this.deselectKeyword(e,i)}},{key:"setSelectedStateByIndex",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e>=this.value.length||e<0||(t?this.selectKeyword(this.value[e],i):this.deselectKeyword(this.value[e],i))}},{key:"selectRangeByIndexes",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e>t){var o=e;e=t,t=o}for(var n=i?l({},this.selection):{},r=i?this.count:0,s=Math.max(e,0);s<=Math.min(t,this.value.length-1);s++)n.hasOwnProperty(this.value[s])&&n[this.value[s]]||(n[this.value[s]]=!0,r++);this.selection=n,this.count=r}},{key:"getSiblingKeyword",value:function(e,t){return 0===t?e<this.value.length&&e>=0?this.value[e]:null:t>0?e<this.value.length-1?this.value[e+1]:null:e>0?this.value[e-1]:null}},{key:"getActiveSiblingKeyword",value:function(e){return this.getSiblingKeyword(this.lastActiveKeywordIndex,e)}},{key:"getSelectionAsArray",value:function(){var e=this;return 0===this.count?[]:this.value.filter((function(t){return e.selection.hasOwnProperty(t)&&e.selection[t]}))}},{key:"lastActiveKeyword",get:function(){return this._lastActiveKeyword},set:function(e){this._lastActiveKeyword=e,e?(this._lastActiveKeywordIndex=this.getIndexOfKeyword(e),this._lastActiveKeywordIndex<0&&(this._lastActiveKeyword=null)):this._lastActiveKeywordIndex=-1}},{key:"lastActiveKeywordIndex",get:function(){return this._lastActiveKeywordIndex},set:function(e){this.value.length>0?(e<0?e=0:e>this.value.length-1&&(e=this.value.length-1),this._lastActiveKeywordIndex=e,this._lastActiveKeyword=this.value[e]):(this._lastActiveKeywordIndex=-1,this._lastActiveKeyword=null)}}]),e}();function m(e,t){if(!e)return!1;if(void 0!==e.classList){if(e.classList.contains(t))return!0}else{if(void 0===e.className)return!1;if(e.className===t)return!0;if(e.className.split(/\s/).some((function(e){return e.trim()===t})))return!0}return!1}function g(e,t){if("undefined"==typeof window)return null;for(;e;){if(e===document)return null;if(m(e,t))return e;e=e.parentNode}return null}function x(e){e&&(void 0!==e.remove?e.remove():e.parentNode.removeChild(e))}var K=null;function k(e){if(!window||!window.navigator)return!1;if(!K){var t=window.navigator.userAgent,i=/Edge\/|Trident\/|MSIE /.test(t),o=!i&&/AppleWebKit/.test(t)&&/Mobile\/\w+/.test(t),n=o||/mac/i.test(window.navigator.platform),r=/apple/i.test(window.navigator.vendor);K={ie:i,mac:n,safari:r,ios:o}}return K[e]}function b(e){return k("mac")?e.metaKey:e.ctrlKey}var I=function(){function e(t,i,n,r){if(o(this,e),!t.$el)throw new Error("ImsKeywordBox interaction context: Master component is not mounted");this.isDragging=r,this.component=t,this.startTime=Date.now(),this.startElement=i.target,this.destroyed=n,this.draggingMyKeywords=[],this.draggingCanvas=null,this.invalidateCache(),this.resetEventHandlers(this.isDragging,!1),this.startPoint=this.getMousePointInfo(i),this.curPoint=this.startPoint}return r(e,[{key:"invalidateCache",value:function(){this._cacheKeywordsElems=null,this._cacheKeywordsBounds={}}},{key:"onMouseEnd",value:function(e){this.curPoint=this.getMousePointInfo(e),this.isDragging?"move"===e.dataTransfer.dropEffect&&this.deleteDraggingMyKeywords():this.startElement===e.target&&this.keywordClick(this.curPoint,e),this.destroy()}},{key:"onMouseUpdate",value:function(e){var t=b(e);if(this.curPoint=this.getMousePointInfo(e),this.isDragging){if(e.dataTransfer.types.includes("text/plain")&&e.preventDefault(),this.component.dragKeywordPosition=this.curPoint.kwdIndex,this.component.dragKeywordIsBegin=!1,this.curPoint.hoverKwdElement){var i=this._getKeywordBounds(this.curPoint.kwdIndex);i&&i.left+i.width/2>e.clientX&&(this.component.dragKeywordIsBegin=!0)}}else if(!this.startPoint.hoverKwdElement){var o=this.startPoint.kwdIndex+this.startPoint.offset;if(this.startPoint.kwdIndex===this.curPoint.kwdIndex)t||(this.component.selectedKeywords.count>0&&this.component.selectedKeywords.clear(),this.component.cursorPosition=o);else{this.component.cursorPosition=-1,o>this.curPoint.kwdIndex&&o--;var n=this.curPoint.kwdIndex;0!==this.curPoint.outside&&n++,this.component.selectedKeywords.lastActiveKeywordIndex=o,this.component.selectedKeywords.selectRangeByIndexes(o,n,t)}}}},{key:"keywordClick",value:function(e,t){if(!e.delButton){var i=b(t),o=e.kwdIndex,n=-1,r=-1===this.component.cursorPosition?this.component.selectedKeywords.lastActiveKeywordIndex:this.component.cursorPosition;if(!e.hoverKwdElement){if(!t.shiftKey&&i)return;t.shiftKey?r>e.kwdIndex&&o++:(o=-1,n=e.kwdIndex+e.offset)}var s=0===t.button;if(2===t.button&&(s=this.component.selectedKeywords.count>0),o>=0&&s){if(t.shiftKey)-1!==this.component.cursorPosition&&(o<r&&r--,this.component.selectedKeywords.lastActiveKeywordIndex=r),this.component.selectedKeywords.selectRangeByIndexes(r,o,i);else{var a=this.component.selectedKeywords.isSelectedByIndex(o);if(i)this.component.selectedKeywords.setSelectedStateByIndex(o,!a,!0);else if(a){if(0===t.button){var l={x:t.clientX,y:t.clientY,kwdIndex:this.curPoint?this.curPoint.kwdIndex:null,kwdElement:null,kwdBounds:null};l.kwdIndex>=0&&(l.kwdElement=this._getHoverKwdElement(l.kwdIndex),l.kwdBounds=this._getKeywordBounds(l.kwdIndex)),this.component.openEditor({click:l})}}else this.component.selectedKeywords.setSelectedStateByIndex(o,!0);this.component.selectedKeywords.lastActiveKeywordIndex=o}this.component.cursorPosition=-1}else-1!==n&&(this.component.setCursorPosition(n,1===e.outside),this.component.selectedKeywords.clear())}}},{key:"getMousePointInfo",value:function(e){var t={kwdIndex:-1,offset:1,hoverKwdElement:null,outside:0,delButton:!1};if(!this.component.value||0===this.component.value.length)return t;var i=e.target;m(i,"ImsKeywordBox-keyword-delete")&&(t.delButton=!0,(i=g(i,"ImsKeywordBox-keyword"))||(i=e.target)),m(i,"ImsKeywordBox-keyword")&&((i=g(i,"ImsKeywordBox-keyword-wrapper"))||(i=e.target));var o=m(i,"ImsKeywordBox-keyword-wrapper"),n=m(i,"ImsKeywordBox-separator");return o||n?(t.kwdIndex=parseInt(i.dataset.kwdInd),o?(t.hoverKwdElement=o,t.offset=0):t.offset=1,t):this._findMousePointInfoByCoords(e.clientX,e.clientY)}},{key:"_findMousePointInfoByCoords",value:function(e,t){var i={kwdIndex:this.component.value?this.component.value.length-1:-1,offset:1,hoverKwdElement:null,outside:1},o=this._getLastKeywordBounds();if(!o)return i;if(t>o.bottom||t>o.top&&e>o.right)return i;var n=this._getFirstKeywordBounds();if(!n)return i;var r=e<o.left;if(t<n.bottom&&r)return i.kwdIndex=-1,i.offset=1,i.outside=-1,i;var s=t-n.top,a=Math.floor(s/n.height);return i.kwdIndex=this._findKeywordEdgeIndex(a,r?-1:1,n.top,n.height)+(r?-1:0),i.offset=1,i.outside=r?-1:1,i}},{key:"_findKeywordEdgeIndex",value:function(e,t,i,o){for(var n=0,r=this.component.value?this.component.value.length-1:-1;n<=r;){var s=Math.floor((r+n)/2),a=this._getKeywordBounds(s),l=a?Math.round((a.top-i)/o):0,d=this._getKeywordBounds(s+t),c=d?Math.round((d.top-i)/o):l+t;if(l===e&&c===e+t)return s;e<l||e===l&&-1===t?r=s-1:n=s+1}return n}},{key:"_getHoverKwdElement",value:function(e){if(!this._cacheKeywordsElems){if(!this.component.$refs.canvas)return null;this._cacheKeywordsElems=this.component.$refs.canvas.querySelectorAll(".ImsKeywordBox-keyword-wrapper")}return e<0||e>=this._cacheKeywordsElems.length?null:this._cacheKeywordsElems[e]}},{key:"_getKeywordBounds",value:function(e){if(!this._cacheKeywordsBounds.hasOwnProperty(e)){var t=this._getHoverKwdElement(e);if(!t)return null;this._cacheKeywordsBounds[e]=t.getBoundingClientRect()}return this._cacheKeywordsBounds[e]}},{key:"_getLastKeywordBounds",value:function(){return this._getKeywordBounds(this.component.value?this.component.value.length-1:-1)}},{key:"_getFirstKeywordBounds",value:function(){return this._getKeywordBounds(0)}},{key:"destroy",value:function(){this.component.dragKeywordPosition=null,this.component.dragKeywordIsBegin=!1,this.resetEventHandlers(this.isDragging,!0),x(this.draggingCanvas),this.destroyed&&this.destroyed()}},{key:"makeDragging",value:function(){this.isDragging||(this.isDragging=!0,this.resetEventHandlers(!1,!1))}},{key:"onDragLeave",value:function(){this.component.dragKeywordPosition=null,this.component.dragKeywordIsBegin=!1}},{key:"resetEventHandlers",value:function(e,t){var i=this;this._onMouseEndHandler&&(window.removeEventListener(e?"dragend":"mouseup",this._onMouseEndHandler),this._onMouseEndHandler=null),this._onMouseUpdateHandler&&(this.component.$el&&this.component.$el.removeEventListener(e?"dragover":"mousemove",this._onMouseUpdateHandler),this._onMouseUpdateHandler=null),this._invalidateCacheHandler&&(window.removeEventListener("resize",this._invalidateCacheHandler,{passive:!0}),window.removeEventListener("scroll",this._invalidateCacheHandler,{passive:!0}),this.component.$refs.scroller&&this.component.$refs.scroller.removeEventListener("scroll",this._invalidateCacheHandler),this._invalidateCacheHandler=null),e&&(this.component.$el.removeEventListener("dragleave",this._onDragLeaveHandler),this._onDragLeaveHandler=null),t||(this._onMouseEndHandler=function(e){return i.onMouseEnd(e)},this._onMouseUpdateHandler=function(e){return i.onMouseUpdate(e)},this._invalidateCacheHandler=function(e){return i.invalidateCache()},window.addEventListener(this.isDragging?"dragend":"mouseup",this._onMouseEndHandler),this.component.$el.addEventListener(this.isDragging?"dragover":"mousemove",this._onMouseUpdateHandler),window.addEventListener("resize",this._invalidateCacheHandler,{passive:!0}),window.addEventListener("scroll",this._invalidateCacheHandler,{passive:!0}),this.component.$refs.scroller.addEventListener("scroll",this._invalidateCacheHandler),this.isDragging&&(this._onDragLeaveHandler=function(e){return i.onDragLeave(e)},this.component.$el.addEventListener("dragleave",this._onDragLeaveHandler)))}},{key:"deleteDraggingMyKeywords",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;(t=void 0!==t?t:this.component.value)||(t=[]);var i=t;if(this.draggingMyKeywords.length>0){var o=-1;i=[];for(var n=0;n<t.length;n++){var r=t[n];this.draggingMyKeywords.indexOf(r)>=0?-1===o&&(o=n):i.push(r)}this.draggingMyKeywords=[],this.component.cursorPosition=o,e&&this.component.$emit("change",i)}return i}}]),e}(),C=function(){function e(t,i,n){o(this,e),this.component=t,this.destroyed=n,this._moveTextareaToCursor(i),this.selectAllDetectTimeout=null,this.selectAllTry=0,this._runHideTimeout()}return r(e,[{key:"_runHideTimeout",value:function(){var e=this;this._hideTimeout=setTimeout((function(){e._hideTimeout=null,e._hideTextarea()}),100)}},{key:"_moveTextareaToCursor",value:function(e){if(this.component.$refs.textArea){var t=this.component.$el.getBoundingClientRect();this.component.$refs.textArea.style.left=e.clientX-t.left-5+"px",this.component.$refs.textArea.style.top=e.clientY-t.top-5+"px",this.component.$refs.textArea.style.width="10px",this.component.$refs.textArea.style.height="10px",this.component.$refs.textArea.style.zIndex=1e4,this.component.$refs.textArea.focus(),this.component.$refs.textArea.value="";var i=this.component.getSelectionsAsJoinedString();this.component.$refs.textArea.value=i+" ",this.component.$refs.textArea.setSelectionRange(0,i.length),this.selectAllTry=0,this._detectSelectAll()}}},{key:"_detectSelectAll",value:function(){var e=this;this.selectAllTry>=10||(this.selectAllTry++,setTimeout((function(){e.component.$refs.textArea&&(e.component.$refs.textArea.selectionEnd===e.component.$refs.textArea.value.length?e.component.selectAll():e._detectSelectAll())}),500))}},{key:"_hideTextarea",value:function(){this.component.$refs.textArea&&(this.component.$refs.textArea.style.left=0,this.component.$refs.textArea.style.top=0,this.component.$refs.textArea.style.width=0,this.component.$refs.textArea.style.height=0,this.component.$refs.textArea.style.zIndex=-2)}},{key:"destroy",value:function(){this._hideTimeout&&clearTimeout(this._hideTimeout),this.selectAllDetectTimeout&&clearTimeout(this.selectAllDetectTimeout),this.destroyed&&this.destroyed(),this.component.$refs.textArea&&(this.component.$refs.textArea.value="")}}]),e}();function _(e){return P.apply(this,arguments)}function P(){return(P=i(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.clipboard.writeText(t);case 3:return e.abrupt("return",e.sent);case 6:e.prev=6,e.t0=e.catch(0),(i=document.createElement("textarea")).style.position="fixed",i.style.top="0",i.style.left="0",i.style.width="10px",i.style.height="10px",document.body.appendChild(i),i.value=t,i.focus(),i.setSelectionRange(0,i.value.length),document.execCommand("copy"),document.body.removeChild(i);case 20:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}function B(e,t,i,o,n,r,s,a,l,d){"boolean"!=typeof s&&(l=a,a=s,s=!1);const c="function"==typeof i?i.options:i;let u;if(e&&e.render&&(c.render=e.render,c.staticRenderFns=e.staticRenderFns,c._compiled=!0,n&&(c.functional=!0)),o&&(c._scopeId=o),r?(u=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,l(e)),e&&e._registeredComponents&&e._registeredComponents.add(r)},c._ssrRegister=u):t&&(u=s?function(e){t.call(this,d(e,this.$root.$options.shadowRoot))}:function(e){t.call(this,a(e))}),u)if(c.functional){const e=c.render;c.render=function(t,i){return u.call(i),e(t,i)}}else{const e=c.beforeCreate;c.beforeCreate=e?[].concat(e,u):[u]}return i}const A="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());function E(e){return(e,t)=>function(e,t){const i=A?t.media||"default":e,o=D[i]||(D[i]={ids:new Set,styles:[]});if(!o.ids.has(e)){o.ids.add(e);let i=t.source;if(t.map&&(i+="\n/*# sourceURL="+t.map.sources[0]+" */",i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t.map))))+" */"),o.element||(o.element=document.createElement("style"),o.element.type="text/css",t.media&&o.element.setAttribute("media",t.media),void 0===S&&(S=document.head||document.getElementsByTagName("head")[0]),S.appendChild(o.element)),"styleSheet"in o.element)o.styles.push(i),o.element.styleSheet.cssText=o.styles.filter(Boolean).join("\n");else{const e=o.ids.size-1,t=document.createTextNode(i),n=o.element.childNodes;n[e]&&o.element.removeChild(n[e]),n.length?o.element.insertBefore(t,n[e]):o.element.appendChild(t)}}}(e,t)}let S;const D={};var $=B({render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span",{staticClass:"ImsKeywordBoxEditor"},[i("input",{ref:"input",staticClass:"ImsKeywordBoxEditor-input",attrs:{type:"text"},domProps:{value:e.rawVal},on:{keydown:e._onKeyDown,blur:e._onBlur,input:function(t){return e._setValue(t.target.value)}}}),e._v(" "),i("span",{ref:"hidden",staticClass:"ImsKeywordBoxEditor-hidden"})])},staticRenderFns:[]},(function(e){e&&e("data-v-207ef990_0",{source:".ImsKeywordBoxEditor{position:relative;display:inline-block}.ImsKeywordBoxEditor-hidden,.ImsKeywordBoxEditor-input{outline:0;border:none;font-size:inherit;font-family:inherit;line-height:inherit;white-space:pre;display:block;padding:0;background:0 0}.ImsKeywordBoxEditor-hidden{position:absolute;top:0;left:0;visibility:hidden;box-sizing:content-box;padding-right:5px}",map:void 0,media:void 0})}),{name:"ImsKeywordBoxEditor",props:{value:{}},data:function(){return{rawVal:this.value}},methods:{_updateSize:function(){if(this.$refs.hidden&&this.$refs.input){this.$refs.hidden.textContent=this.rawVal;var e=this.$refs.hidden.getBoundingClientRect();this.$refs.input.style.width=e.width+"px"}},_setValue:function(e){this.rawVal!==e&&(this.rawVal=e,this._updateSize(),this.$emit("input",e))},_onBlur:function(){this.$emit("blur")},setCursor:function(e){this.$refs.input&&this.$refs.input.setSelectionRange(e,e)},focus:function(){this.$refs.input&&this.$refs.input.focus()},blur:function(){this.$refs.blur&&this.$refs.blur.blur()},isSelectionAtFirst:function(){return this.$refs.input.selectionStart===this.$refs.input.selectionEnd&&0===this.$refs.input.selectionStart},isSelectionAtEnd:function(){return this.$refs.input.selectionStart===this.$refs.input.selectionEnd&&this.$refs.input.selectionStart===this.rawVal.length},_onKeyDown:function(e){if(this.$refs.input)switch(e.key){case"Enter":case"Escape":e.preventDefault(),this.$emit("command",{command:"commit"});break;case"Tab":e.preventDefault(),this.$emit("command",{command:"move",dir:e.shiftKey?-1:1,cursorAt:0});break;case"ArrowLeft":case"ArrowRight":var t="ArrowLeft"===e.key&&this.isSelectionAtFirst(),i="ArrowRight"===e.key&&this.isSelectionAtEnd();(t||i)&&(e.preventDefault(),this.$emit("command",{command:"move",dir:t?-1:1,cursorAt:i?0:null}));break;case"Backspace":case"Delete":var o="Backspace"===e.key&&this.isSelectionAtFirst(),n="Delete"===e.key&&this.isSelectionAtEnd();(o||n)&&(e.preventDefault(),this.$emit("command",{command:"delSep",dir:o?-1:1}))}}},mounted:function(){this._updateSize()},watch:{value:function(){this.rawVal!==this.value&&(this.rawVal=this.value,this._updateSize())}}},void 0,!1,void 0,!1,E,void 0,void 0),T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(i,e);var t=h(i);function i(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return o(this,i),(e=t.call(this)).size=n,e.history=[],e.pointer=0,e}return r(i,[{key:"init",value:function(e,t){this.component=e,this.history=[t]}},{key:"push",value:function(e){this.history=[e].concat(f(this.history.slice(this.pointer,this.pointer+this.size))),this.pointer=0}},{key:"undo",value:function(){this.pointer<this.history.length-1&&(this.pointer++,this.component.emitValue(this.history[this.pointer],!1))}},{key:"redo",value:function(){this.pointer>0&&(this.pointer--,this.component.emitValue(this.history[this.pointer],!1))}}]),i}(function(){function e(){o(this,e)}return r(e,[{key:"init",value:function(e,t){}},{key:"push",value:function(e){}},{key:"undo",value:function(){}},{key:"redo",value:function(){}}]),e}()),M=B({render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"ImsKeywordBox",class:{"state-focus":e.focused},on:{mousedown:e._onMouseDown,dragstart:e._onDragStart,dragenter:e._onDragEnter,drop:e._onDrop,contextmenu:e._onContextMenu}},[i("textarea",{ref:"textArea",staticClass:"ImsKeywordBox-textarea",attrs:{autocorrect:"off",autocapitalize:"off",spellcheck:"false"},on:{keydown:e._onTextareaKeyDown,blur:e._onTextareaBlur,focus:e._onTextareaFocus,paste:e._onTextareaPaste,copy:e._onTextareaCopy,cut:e._onTextareaCut,input:e._onTextareaInput}}),e._v(" "),i("div",{ref:"scroller",staticClass:"ImsKeywordBox-scroller",on:{"&scroll":function(t){return e.emitScroll(t)}}},[i("div",{ref:"canvas",staticClass:"ImsKeywordBox-canvas"},[e.value&&e.value.length>0?[i("span",{staticStyle:{"padding-right":"0.1px"}},[e._l(e.value,(function(t,o){return[i("span",{class:e.separatorIsNewLine?"ImsKeywordBox-line":"ImsKeywordBox-inline"},[e.editorPosition===o?[i("ims-keyword-box-editor",{ref:"editor",refInFor:!0,staticClass:"ImsKeywordBox-editor",on:{blur:e._editorCommit,command:e._editorCommand},model:{value:e.editorValue,callback:function(t){e.editorValue=t},expression:"editorValue"}}),e.separatorIsNewLine||e.editorInstead?e._e():i("span",{staticClass:"ImsKeywordBox-separator",attrs:{"data-kwd-ind":o}},[e._v(e._s(e.separatorCharacter))])]:e._e(),e.editorPosition===o&&e.editorInstead?e._e():i("span",{staticClass:"ImsKeywordBox-keyword-wrapper",class:{"state-highlighted":e.selectedKeywords.isSelected(t)},attrs:{draggable:"","data-kwd-ind":o}},[i("span",{staticClass:"ImsKeywordBox-keyword",class:e._getKeywordClasses(t,o)},[e._v(e._s(t)),e.showDeleteButton?i("span",{staticClass:"ImsKeywordBox-keyword-delete",on:{click:function(t){return e.deleteKeywordByIndex(o)}}}):e._e()])]),(o<e.value.length-1||e.editorPosition===e.value.length)&&!e.separatorIsNewLine?i("span",{staticClass:"ImsKeywordBox-separator",attrs:{"data-kwd-ind":o}},[e._v(e._s(e.separatorCharacter))]):e._e()],2)]}))],2)]:[i("div",{staticClass:"ImsKeywordBox-stub",class:{"state-cursor-after":0===e.cursorPosition&&e.focused||-1===e.dragKeywordPosition,"state-cursor-blink":0===e.cursorPosition&&e.focused&&null===e.dragKeywordPosition}})],e._v(" "),(!e.value||!e.value.length)&&0===e.editorPosition||e.value&&e.editorPosition===e.value.length?i("ims-keyword-box-editor",{ref:"editor",staticClass:"ImsKeywordBox-editor",on:{blur:e._editorCommit,command:e._editorCommand},model:{value:e.editorValue,callback:function(t){e.editorValue=t},expression:"editorValue"}}):e._e()],2)])])},staticRenderFns:[]},(function(e){e&&e("data-v-14ed41d5_0",{source:".ImsKeywordBox{border:1px solid #ccc;border-radius:4px;overflow:auto;position:relative;padding:0 6px;cursor:text}.ImsKeywordBox-scroller{height:100%;overflow-x:hidden;position:relative}.ImsKeywordBox-canvas{display:block;padding:4px 4px 4px 4px;line-height:2em;position:relative;user-select:none;outline:0;min-height:100%;box-sizing:border-box}.ImsKeywordBox-keyword-wrapper{white-space:nowrap;display:inline-block}.ImsKeywordBox-keyword-wrapper.state-highlighted{position:relative}.ImsKeywordBox-keyword-wrapper.state-highlighted>.ImsKeywordBox-keyword{cursor:text}.ImsKeywordBox-keyword-wrapper.state-highlighted:before{content:\"\";position:absolute;width:100%;height:2em;background:#e9e9e9;left:-4px;top:0;padding-left:4px;padding-right:5px}.ImsKeywordBox.state-focus .ImsKeywordBox-scroller>.ImsKeywordBox-canvas .ImsKeywordBox-keyword-wrapper.state-highlighted:before{background:#d7d4f0}.ImsKeywordBox-keyword-wrapper.state-highlighted{background:#faa}.ImsKeywordBox-textarea{width:0;height:0;overflow:hidden;padding:0;display:block;resize:none;position:absolute;background:0 0;border:none;top:0;left:0;color:transparent;outline:0}.ImsKeywordBox-textarea::-moz-selection,.ImsKeywordBox-textarea::selection{color:transparent}.ImsKeywordBox-keyword{padding:2px 7px;border:1px solid #ccc;border-radius:4px;line-height:1.4em;display:inline-block;white-space:nowrap;cursor:default;background-color:rgba(250,250,250,.7);position:relative}.ImsKeywordBox-keyword.state-cursor-after:after,.ImsKeywordBox-keyword.state-cursor-before:after,.ImsKeywordBox-stub.state-cursor-after:after,.ImsKeywordBox-stub.state-cursor-before:after{content:\"\";display:block;width:1px;height:29px;background:#000;position:absolute;top:-2px;pointer-events:none}.ImsKeywordBox-keyword.state-cursor-after.state-cursor-blink:after,.ImsKeywordBox-keyword.state-cursor-before.state-cursor-blink:after,.ImsKeywordBox-stub.state-cursor-after.state-cursor-blink:after,.ImsKeywordBox-stub.state-cursor-before.state-cursor-blink:after{animation:ImsKeywordBox-cursor-blink .5s infinite alternate}.ImsKeywordBox-keyword.state-cursor-before:after,.ImsKeywordBox-stub.state-cursor-before:after{left:-5px}.ImsKeywordBox-keyword.state-cursor-after:after{right:-6px}.ImsKeywordBox-keyword.state-duplicate{background-color:#ff9c9c}.ImsKeywordBox-stub{display:inline-block;width:1px;height:1.4em;position:relative}.ImsKeywordBox-stub.state-cursor-after:after{right:0}.ImsKeywordBox-separator{position:relative;display:inline-block;white-space:pre}.ImsKeywordBox-separator:first-child,.ImsKeywordBox-separator:last-child{color:#aaa}.ImsKeywordBox-line{display:block}.ImsKeywordBox-keyword-delete{background:url(\"data:image/svg+xml,%3Csvg viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='m18.011 3.8674-6.0106 6.0106-6.0106-6.0106-2.1212 2.1212 6.0106 6.0106-6.0106 6.0106 2.1212 2.1212 6.0106-6.0106 6.0106 6.0106 2.1212-2.1212-6.0106-6.0106 6.0106-6.0106z'/%3E%3C/svg%3E%0A\") no-repeat right center;display:inline-block;width:12px;height:12px;cursor:pointer;background-size:contain;opacity:.5;position:relative;top:1px;margin-left:4px}.ImsKeywordBox-keyword-delete:hover{opacity:1}@keyframes ImsKeywordBox-cursor-blink{0%{opacity:1}49.9%{opacity:1}50%{opacity:0}100%{opacity:0}}",map:void 0,media:void 0})}),{name:"ImsKeywordBox",components:{ImsKeywordBoxEditor:$},props:{value:{},showDeleteButton:{type:Boolean,default:!0},separator:{type:String,default:", "},splittingRegexp:{type:RegExp,default:function(){return/[;,\r\n]/}},preprocessKeyword:{type:Function,default:null},getKeywordClasses:{type:Function,default:null},scrollY:{type:Number,default:0},handleExceptions:{type:Function,default:null},emitValueEvent:{type:String,default:"input"},customizeMultiKeywordDraggingCanvas:{type:Function,default:null},historyController:{type:Object,default:function(){return new T}}},data:function(){return{selectedKeywords:new w(this.value),cursorPositionRaw:-1,cursorPositionAfter:!1,interactionContext:null,contextMenuContext:null,highlightDuplicated:null,dragKeywordPosition:null,dragKeywordIsBegin:!1,muteNativeClipboardEventsTime:Date.now()-100,focused:!1,editorPosition:-1,editorInstead:!1,editorValue:null}},computed:{cursorPosition:{get:function(){return this.cursorPositionRaw},set:function(e){this.cursorPositionRaw=e,this.cursorPositionAfter=!1}},separatorIsNewLine:function(){return"\r\n"===this.separator},separatorCharacter:function(){return this.separator}},methods:{setCursorPosition:function(e,t){this.cursorPositionRaw=e,this.cursorPositionAfter=t},deleteSelectedKeywords:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;(t=void 0!==t?t:this.value)||(t=[]);var i=t;if(this.selectedKeywords.count>0){var o=-1;i=[];for(var n=0;n<t.length;n++){var r=t[n];this.selectedKeywords.isSelected(r)?-1===o&&(o=n):i.push(r)}this.selectedKeywords.clear(),this.cursorPosition=o,e&&this.emitValue(i)}return i},eraseEofCommand:function(){var e=this.selectedKeywords.count>0?this.selectedKeywords.getFirstSelectedIndex():this.cursorPosition;e<0&&(e=0);var t=this.value?this.value.slice(0,e):[];this.cursorPosition=t.length,this.selectedKeywords.clear(),this.emitValue(t)},clearCommand:function(){this.selectedKeywords.clear(),this.cursorPosition=-1,this.emitValue([])},deleteWordFromCursor:function(e){if(this.cursorPosition>=0){var t=this.value?f(this.value):[];t.splice(this.cursorPosition+e,1),this.cursorPosition=Math.max(this.cursorPosition+e,0),this.selectedKeywords.clear(),this.emitValue(t)}},getSelectionsAsJoinedString:function(){return this.selectedKeywords.getSelectionAsArray().join(this.separatorCharacter)},copyCommand:function(){var e=this;return i(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!(e.selectedKeywords.count>0)){t.next=4;break}return t.next=4,_(e.getSelectionsAsJoinedString());case 4:t.next=10;break;case 6:if(t.prev=6,t.t0=t.catch(0),e.handleExceptions&&e.handleExceptions(t.t0)){t.next=10;break}throw t.t0;case 10:case"end":return t.stop()}}),t,null,[[0,6]])})))()},cutCommand:function(){var e=this;return i(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.selectedKeywords.count>0)){t.next=4;break}return t.next=3,e.copyCommand();case 3:e.deleteSelectedKeywords();case 4:case"end":return t.stop()}}),t)})))()},pasteCommand:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t=void 0!==t?t:this.value,this.selectedKeywords.count>0&&(t=this.deleteSelectedKeywords(!1)),e?this._pasteCommandImpl(this.cursorPosition,t,e,i):i?i(t):this.emitValue(t)},selectAll:function(){this.cursorPosition=-1,this.selectedKeywords.selectAll()},focus:function(){this.$refs.textArea&&this.$refs.textArea.focus()},emitScroll:function(){this.$refs.scroller&&this.$emit("update:scrollY",this.$refs.scroller.scrollTop)},_pasteCommandImpl:function(e,t,i){var o=this,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(i){e<0&&(e=0),t||(t=[]);var r=t,s=this.splittingRegexp?i.split(this.splittingRegexp):[i],a=s;if(this.preprocessKeyword){a=[];for(var d=0;d<s.length;d++){var c=this.preprocessKeyword(s[d]);c&&(Array.isArray(c)?a=a.concat(c):a.push(c))}}for(var u=new Set(r),h=new Set,y=[],p=null,v=0;v<a.length;v++){var w=a[v];if(w&&!h.has(w)){if(h.add(w),u.has(w)){p||(p={}),p[w]=Date.now();var m=t.indexOf(w);if(m<e)continue;(t=t!==r?t:f(t)).splice(m,1)}y.push(w)}}if(this.selectedKeywords.clear(),this.cursorPosition=e+y.length,this.selectedKeywords.lastActiveKeywordIndex=this.cursorPosition,0!==y.length||t!==r){var g=f(t);g.splice.apply(g,[e,0].concat(y)),n?n(g):this.emitValue(g)}if(p)if(this.highlightDuplicated)this.highlightDuplicated=l(l({},this.highlightDuplicated),p);else{this.highlightDuplicated=p;var x=function e(){if(o.highlightDuplicated){var t=null,i=Date.now()-600;for(var n in o.highlightDuplicated)o.highlightDuplicated.hasOwnProperty(n)&&o.highlightDuplicated[n]>i&&(t||(t={}),t[n]=o.highlightDuplicated[n]);o.highlightDuplicated=t,o.highlightDuplicated&&setTimeout(e,200)}};setTimeout(x,200)}return y}},_onMouseDown:function(e){var t=this;g(e.target,"ImsKeywordBox-editor")||(this.$refs.textArea&&setTimeout((function(){t.$refs.textArea&&t.$refs.textArea.focus()}),10),this.interactionContext||(this.interactionContext=new I(this,e,(function(){return t.interactionContext=null}),!1)))},_onTextareaFocus:function(){var e=this;this.focused=!0,setTimeout((function(){document.activeElement===e.$refs.textArea&&(e.focused||e.$emit("focus"))}),100)},_onTextareaBlur:function(){var e=this;this.focused=!1,setTimeout((function(){document.activeElement!==e.$refs.textArea&&e.focused&&e.$emit("blur")}),100)},_onDragStart:function(e){var t=this,i=e.target.dataset.kwdInd;if(void 0!==i&&(this.selectedKeywords.isSelectedByIndex(i)||(this.cursorPosition=-1,this.selectedKeywords.setSelectedStateByIndex(i,!0,!1)),e.dataTransfer.setData("text/plain",this.getSelectionsAsJoinedString()),this.interactionContext?this.interactionContext.isDragging||this.interactionContext.makeDragging():this.interactionContext=new I(this,e,(function(){return t.interactionContext=null}),!0),this.interactionContext.draggingMyKeywords=this.selectedKeywords.getSelectionAsArray(),this.selectedKeywords.count>1)){var o=document.createElement("canvas");if(o.style.position="absolute",o.style.left="-100%",document.body.append(o),this.customizeMultiKeywordDraggingCanvas)this.customizeMultiKeywordDraggingCanvas(o,this.selectedKeywords);else{var n=o.getContext("2d");o.width=24,o.height=15,n.fillStyle="#d7d4f0",n.fillRect(0,0,o.width,o.height),n.fillStyle="#000",n.font="12px "+getComputedStyle(this.$el).fontFamily,n.textBaseline="top",n.textAlign="center",n.fillText(this.selectedKeywords.count,12,3)}e.dataTransfer.setDragImage(o,-20,-10),this.interactionContext.draggingCanvas=o}},_onDragEnter:function(e){var t=this;g(e.target,"ImsKeywordBox-editor")||(e.dataTransfer.types.includes("text/plain")&&e.preventDefault(),this.interactionContext?this.interactionContext.isDragging||this.interactionContext.makeDragging():this.interactionContext=new I(this,e,(function(){return t.interactionContext=null}),!0))},_onDrop:function(e){if(!g(e.target,"ImsKeywordBox-editor")){var t=e.dataTransfer.getData("text/plain");e.preventDefault();var i=this.value?this.value:[],o=i[this.dragKeywordPosition];if(this.editorPosition>=0&&(this.editorInstead&&(i=f(i)).splice(this.editorPosition,1),this.editorPosition=-1),this.interactionContext){if(this.interactionContext.draggingMyKeywords.indexOf(o)>=0){var n=new Set;this.interactionContext.draggingMyKeywords.forEach((function(e,t){n.add(e)}));for(var r=null,s=0,a=!1,l=0;l<i.length;l++)n.has(i[l])?(null===r&&(r=l,s++),a||i[l]!==o||(this.dragKeywordPosition=r-1,this.dragKeywordIsBegin=!1,o=this.dragKeywordPosition>=0?this.value[this.dragKeywordPosition]:null,a=!0)):r=null;if(1===s)return void this.interactionContext.destroy()}i=this.interactionContext.deleteDraggingMyKeywords(!1,i)}var d=o?i.indexOf(o):this.dragKeywordPosition;d<0&&(d=this.dragKeywordPosition);var c=this._pasteCommandImpl(d+(this.dragKeywordIsBegin?0:1),i,t);this.cursorPosition=-1,this.selectedKeywords.selectKeywordsArray(c),this.interactionContext&&this.interactionContext.destroy()}},_onTextareaKeyDown:function(e){var t,i=this,o=!1,n=!(t=e).key||t.altKey||t.ctrlKey||t.metaKey?null:"Spacebar"===t.key?" ":1===t.key.length||t.key.length>1&&/[^a-zA-Z0-9]/.test(t.key)?t.key:null,r=!!n,s=b(e),a=this.value?this.value:[];switch(e.key){case"Shift":case"Alt":case"AltGraph":case"Control":case"Tab":case"CapsLock":case"Fn":case"FnLock":case"Hyper":case"Meta":case"OS":case"NumLock":case"ScrollLock":case"Scroll":case"Super":case"Symbol":case"SymbolLock":return;case"PageUp":case"PageDown":case"Insert":r=!0;break;case"ArrowUp":case"ArrowDown":if(this.selectedKeywords.count>0&&!e.shiftKey){var l="ArrowDown"===e.key?1:-1;this.cursorPosition=l>0?this.selectedKeywords.getLastSelectedIndex()+1:this.selectedKeywords.getFirstSelectedIndex(),this.selectedKeywords.clear(),o=!0}break;case"ArrowLeft":case"ArrowRight":r=!0;var d="ArrowRight"===e.key?1:-1;if(this.selectedKeywords.count>0){if(s||e.shiftKey){var c=e.shiftKey,u=this.selectedKeywords.getActiveSiblingKeyword(d);u&&(c&&this.selectedKeywords.isSelected(u)?this.selectedKeywords.deselectKeyword(this.selectedKeywords.lastActiveKeyword,!0):this.selectedKeywords.selectKeyword(u,c),this.selectedKeywords.lastActiveKeywordIndex+=d)}else this.cursorPosition=d>0?this.selectedKeywords.getLastSelectedIndex()+1:this.selectedKeywords.getFirstSelectedIndex(),this.selectedKeywords.clear();o=!0}else if(s){if(e.shiftKey){var h=this.selectedKeywords.getSiblingKeyword(this.cursorPosition,d<0?-1:0);h&&(this.selectedKeywords.selectKeyword(h),this.selectedKeywords.lastActiveKeywordIndex=this.cursorPosition+(d<0?-1:0),this.cursorPosition=-1)}else this.cursorPosition=Math.min(Math.max(this.cursorPosition+d,0),a.length);o=!0}else(d<0&&0===this.cursorPosition||d>0&&this.cursorPosition===a.length)&&(o=!0);break;case"Clear":this.clearCommand(),o=!0;break;case"eraseEofCommand":this.eraseEofCommand(),o=!0;break;case"End":case"Home":var f="Home"===e.key?0:a.length;if(e.shiftKey){var y=this.selectedKeywords.count>0?this.selectedKeywords.lastActiveKeywordIndex:this.cursorPosition;y>f&&0===f&&0===this.selectedKeywords.count&&y--,this.selectedKeywords.selectRangeByIndexes(y,f,!0),this.selectedKeywords.lastActiveKeywordIndex=f,this.cursorPosition=-1}else this.selectedKeywords.clear(),this.cursorPosition=f;o=!0;break;case"Delete":case"Backspace":r=!0,this.selectedKeywords.count>0&&-1===this.cursorPosition?(this.deleteSelectedKeywords(),o=!0):s&&(this.deleteWordFromCursor("Delete"===e.key?0:-1),o=!0);break;default:var p=function(e){if(void 0!==e.code)return e.code;var t={65:"KeyA",67:"KeyC",86:"KeyV",88:"KeyX",89:"KeyY",90:"KeyZ"};return t.hasOwnProperty(e.which)?t[e.which]:null}(e);if("Copy"===e.key||"KeyC"===p&&s)this.muteNativeClipboardEventsTime=Date.now(),this.copyCommand(),o=!0;else if("Cut"===e.key||"KeyX"===p&&s)this.muteNativeClipboardEventsTime=Date.now(),this.cutCommand(),o=!0;else{if("Paste"===e.key||"KeyV"===p&&s)return void(this.$refs.textArea&&(this.$refs.textArea.value=""));"Redo"===e.key||"KeyY"===p&&s||"KeyZ"===p&&s&&e.shiftKey?(this.historyController&&this.historyController.redo(),o=!0):"Undo"===e.key||"KeyZ"===p&&s?(this.historyController&&this.historyController.undo(),o=!0):"KeyA"===p&&s&&(this.selectAll(),o=!0)}}if(o)e.preventDefault(),this.$nextTick((function(){var e=i.selectedKeywords.count>0?i.selectedKeywords.lastActiveKeywordIndex:i.cursorPosition;if(!(e<0)&&i.$el){var t=i.$el.querySelector('.ImsKeywordBox-keyword-wrapper[data-kwd-ind="'+e+'"]');if(t)if(k("ie")||k("safari")||k("ios")){if(!i.$refs.scroller)return;var o=i.$refs.scroller.getBoundingClientRect(),n=t.getBoundingClientRect();n.bottom<o.top+10?(i.$refs.scroller.scrollTop-=o.top-n.bottom+n.height,i.emitScroll()):n.top>o.bottom-10&&(i.$refs.scroller.scrollTop+=n.top-o.bottom+n.height,i.emitScroll())}else t.scrollIntoView({block:"nearest"})}}));else if(r){var v=this.value?this.value:[];n&&this.selectedKeywords.count>0&&(v=this.deleteSelectedKeywords());var w={keyDownEvent:e};n&&this.cursorPosition===v.length&&v.length>0&&(this.splittingRegexp&&this.splittingRegexp.test(n)||(w.appendSeparator=this.separator)),this.openEditor(w)}},_onTextareaPaste:function(e){if(e.preventDefault(),!(this.muteNativeClipboardEventsTime+100>Date.now())){this.muteNativeClipboardEventsTime=Date.now();var t=(e.originalEvent||e).clipboardData.getData("text/plain");this.pasteCommand(t)}},_onTextareaCopy:function(e){e.preventDefault(),this.muteNativeClipboardEventsTime+100>Date.now()||(this.muteNativeClipboardEventsTime=Date.now(),this.copyCommand())},_onTextareaCut:function(e){e.preventDefault(),this.muteNativeClipboardEventsTime+100>Date.now()||(this.muteNativeClipboardEventsTime=Date.now(),this.cutCommand())},_onTextareaInput:function(e){e.preventDefault(),this.selectedKeywords.count>0&&this.deleteSelectedKeywords(),this.openEditor({put:e.data})},deleteKeywordByIndex:function(e){if(this.value&&!(this.value.length<=e)){var t=f(this.value);t.splice(e,1),this.emitValue(t)}},openEditor:function(e){var t=this;this.editorPosition=this.cursorPosition,this.editorValue=null,this.editorInstead=!!e.instead;var i=null!==e.cursorAt&&void 0!==e.cursorAt?e.cursorAt:null;if(e.put&&(this.editorValue=e.put),e.keyDownEvent)switch(e.keyDownEvent.key){case"ArrowLeft":this.editorInstead=!0,this.editorPosition--,e.keyDownEvent.preventDefault();break;case"ArrowRight":this.editorInstead=!0,e.keyDownEvent.preventDefault(),i=0;break;case"Delete":this.editorInstead=!0,i=0;break;case"Backspace":this.editorInstead=!0,this.editorPosition--}e.click&&e.click.kwdIndex>=0&&(this.editorPosition=e.click.kwdIndex,this.editorInstead=!0,i=this._getClickedSymbolPos(e.click)),this.editorInstead&&this.value&&this.editorPosition<this.value.length&&(this.editorValue=this.value[this.editorPosition]),this.selectedKeywords.clear(),this.$nextTick((function(){var e=Array.isArray(t.$refs.editor)?t.$refs.editor[0]:t.$refs.editor;e&&(e.focus(),null!==i&&e.setCursor(i))}))},_getClickedSymbolPos:function(e){if(!e.kwdElement)return 0;if(!e.kwdElement.cloneNode)return 0;if(!this.$refs.canvas)return 0;var t=e.kwdElement.cloneNode(!0),i=t.querySelector(".ImsKeywordBox-keyword");if(!i)return 0;var o=e.x-e.kwdBounds.left,n=i.textContent.split("");i.innerHTML="",this.$refs.canvas.appendChild(t);var r,s=t.getBoundingClientRect(),a=0,l=v(n);try{for(l.s();!(r=l.n()).done;){var d=r.value,c=window.document.createElement("span");c.textContent=d,i.appendChild(c);var u=c.getBoundingClientRect();if(u.left+u.width/2-s.left>o)break;a++}}catch(e){l.e(e)}finally{l.f()}return x(t),a},_onContextMenu:function(e){var t=this;this.contextMenuContext&&this.contextMenuContext.destroy(),this.contextMenuContext=new C(this,e,(function(){return t.contextMenuContext=null}))},_getKeywordClasses:function(e,t){var i=null===this.dragKeywordPosition&&this.focused,o=i&&this.cursorPositionRaw===t&&!this.cursorPositionAfter||this.dragKeywordPosition===t&&this.dragKeywordIsBegin||-1===this.dragKeywordPosition&&0===t,n=i&&this.cursorPositionRaw===t+1&&(this.value&&t===this.value.length-1||this.cursorPositionAfter)||this.dragKeywordPosition===t&&!this.dragKeywordIsBegin,r={"state-cursor-before":o,"state-cursor-after":n,"state-cursor-blink":(o||n)&&i,"state-duplicate":this.highlightDuplicated&&this.highlightDuplicated.hasOwnProperty(e)};if(this.getKeywordClasses){var s=this.getKeywordClasses(e,t);s&&("string"==typeof s?r[s]=!0:Array.isArray(s)?s.forEach((function(e){return r[e]=!0})):Object.assign(r,s))}return r},emitValue:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&this.historyController&&this.historyController.push(e),this.$emit(this.emitValueEvent,e)},_editorCommit:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!(this.editorPosition<0)){var i=this.editorValue?this.editorValue.trim():"";return this.cursorPosition=this.editorPosition,this.editorInstead&&this.selectedKeywords.setSelectedStateByIndex(this.editorPosition,!0,!1),this.pasteCommand(i,e,t),this.focus(),this.editorPosition=-1,i}},_editorCommand:function(e){var t=this;switch(e.command){case"commit":this._editorCommit();break;case"move":var i=this.editorPosition;if(e.dir<0){if(this.editorPosition<=0)return;i--}else{if(!this.value||this.editorPosition>=this.value.length)return;i++}this._editorCommit(),this.cursorPosition=i,this.openEditor({instead:!0,cursorAt:e.cursorAt});break;case"delSep":if(!this.value)return;var o=this.editorPosition;if(e.dir<0){if(this.editorPosition<=0)return;o--}else if(!this.value||this.editorPosition>=this.value.length)return;var n=this.value,r=this._editorCommit(n,(function(e){return n=e})),s=n[o],a=r?n[o+1]:"",l=r||e.dir<0?s.length:0;this.cursorPosition=o;var d=f(n);r&&d.splice(o+1,1),d[o]=s+a,this.emitValue(d),this.$nextTick((function(){t.openEditor({instead:!0,cursorAt:l})}))}}},created:function(){this.historyController&&this.historyController.init(this,this.value)},mounted:function(){this.$refs.scroller&&(this.$refs.scroller.scrollTop=this.scrollY),this.cursorPosition=this.value?this.value.length:0},destroyed:function(){this.interactionContext&&this.interactionContext.destroy(),this.contextMenuContext&&this.contextMenuContext.destroy()},watch:{value:function(){this.selectedKeywords.setValue(this.value),this.interactionContext&&this.interactionContext.invalidateCache()},historyController:function(){this.historyController&&this.historyController.init(this,this.value)}}},void 0,!1,void 0,!1,E,void 0,void 0),R=function(e){R.installed||(R.installed=!0,e.component("ImsKeywordBox",M))},O={install:R},V=null;return"undefined"!=typeof window?V=window.Vue:"undefined"!=typeof global&&(V=global.Vue),V&&V.use(O),M.install=R,e.default=M,e}({});